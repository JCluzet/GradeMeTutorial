<html><head>
	<link rel="stylesheet" type="text/css" href="style.css">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>42 Inception TIPS</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TLXTG40YLK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TLXTG40YLK');
</script>

	<!-- Menu -->
	<header>
		<a href="#accueil"><img src="img/GRADEME.png" class="logo" alt="logo du site"></a>
		<nav>
				<li><a href="#docker">Docker</a></li>
				<li><a href="#sujet">Sujet</a></li>
				<li><a href="#nginx">NGINX</a></li>
				<li><a href="#mariadb">MariaDB</a></li>
				<li><a href="#wordpress">WordPress</a></li>
				<li><a href="#compose">Compose</a></li>
				<li><a href="#volumes">Volumes</a></li>
		</nav>
	</header>
</head>

<article id="accueil" class="page sans">

	<br>
	<br>
	<br>
	<br>
	<br>
	<figure id="img-accueil" class="img-accueil">
		<a href="img/docker-compose.png"><img style="width:1280px" src="img/docker-compose.png"/></a>
	</figure>
	<br>
	<br>
	<br>
	<br>

	<hr id="ligne-accueil"/><br>

	<!-- OBJECTIFS D'APPRENTISSAGE -->

	<h1 id="objectifs">Objectifs dâ€™apprentissage</h1>
	<br>
	<br>
		<ol class="block-color-gray">
			<li>1. Comprendre <strong>Docker</strong> et <strong>Compose</strong>.</li>
		</ol>
		<ol>
			<li><mark class="highlight-gray">2. DÃ©couvrir les diffÃ©rents points du </mark><strong><mark class="highlight-gray">sujet</mark></strong><mark class="highlight-gray"> dâ€™Inception.</mark></li>
		</ol>
		<ol>
			<li><mark class="highlight-gray">3. Mettre en place le container </mark><strong><mark class="highlight-gray">NGINX</mark></strong></li>
		</ol>
		<ol>
			<li><mark class="highlight-gray">4. Mettre en place le container </mark><strong><mark class="highlight-gray">MariaDB</mark></strong></li>
		</ol>
		<ol>
			<li><mark class="highlight-gray">5. Mettre en place le container </mark><strong><mark class="highlight-gray">WordPress</mark></strong></li>
		</ol>
		<ol>
			<li><mark class="highlight-gray">6. Relier les containers avec </mark><strong><mark class="highlight-gray">Compose</mark></strong></li>
		</ol>
		<ol>
			<li><mark class="highlight-gray">7. Comprendre les volumes de </mark><strong><mark id="docker" class="highlight-gray">Compose</mark></strong></li>
		</ol>
		<ol>
			<li><mark class="highlight-gray">8. </mark><span style="border-bottom:0.05em solid"><mark class="highlight-gray">Finaliser</mark></span><mark class="highlight-gray"> le projet</mark></li>
		</ol>
		<br>
		<br>

	<!----------------------------------------------------------------- 1. COMPRENDRE DOCKER ------------------------------------------------------------------>

	<h1>1. Comprendre <span style="border-bottom:0.05em solid">Docker</span><em><strong> </strong></em><strong>:</strong></h1>
	<br>
	<br>
	<br>
		<p>
			ğŸ“ŒÂ Lâ€™avantage de Docker est clair, il <mark class="highlight-teal"><strong>rÃ©sout </strong></mark>lâ€™un des plus <strong>gros problÃ¨mes des dÃ©veloppeurs</strong>:
		</p>

		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ‘‰</span></div>
			<div style="width:100%"><mark class="highlight-gray_background">Se retrouver Ã  crÃ©er un super programme sur son ordinateur, et se rendre compte quâ€™il ne fonctionne que sur son propre ordinateur. Pour lâ€™utiliser ailleurs il va falloir installer les dÃ©pendances requises ğŸ¤¯</mark></div>
		</figure>
		<br>

		<p class="block-color-gray">
			Souvenez vous ce <strong><mark class="highlight-teal">super programme</mark></strong> que vous aviez trouvÃ© sur <strong>Github</strong>, vous lâ€™installez comme prÃ©vu par le tutoriel du ReadMe ğŸ“„, mais lâ€™installation <strong><mark class="highlight-red">crash</mark></strong> indiquant â€œ<strong><em>You have missing dependencies</em></strong>â€, ou encore â€œ<em><strong>This version of this file is not compatible with your OS</strong></em>â€ ğŸ˜£
		</p>

		<figure class="block-color-gray callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ‘‰</span></div>
			<div style="width:100%">Alors oui, vous pouvez rester un <mark class="highlight-teal"><strong>bon dÃ©veloppeur</strong></mark>Â et proposer un super <strong>script qui installera ces dÃ©pendances</strong>, mais vous ne pouvez pas prÃ©voir que lâ€™utilisateur soit sur Mac, Linux ou encore quâ€™il ait une version dâ€™OS si vieille que celle ci ne connait mÃªme pas vos dÃ©pendances !
			</div>
		</figure>

		<ul class="toggle">
			<li>
				<details close="">
					<summary>âš™ï¸Â Les types de problÃ¨mes que corrige Docker</summary>
					<ul>
						<li style="list-style-type:disc">Une dÃ©pendance nâ€™est pas compatible avec votre version de logiciel ğŸ˜…</li>
					</ul>
					<ul>
						<li style="list-style-type:disc">Vous possÃ©dez dÃ©jÃ  la dÃ©pendance mais dans une version diffÃ©rente ğŸ˜‘</li>
					</ul>
					<ul>
						<li style="list-style-type:disc">Votre dÃ©pendance nâ€™existe pas sur votre OS ğŸ˜“</li>
					</ul>
					<ul>
						<li style="list-style-type:disc">Votre dÃ©pendance crash au lancement ğŸ˜®â€ğŸ’¨</li>
					</ul>
					<ul>
						<li style="list-style-type:disc">etcâ€¦</li>
					</ul>
				</details>
			</li>
		</ul>
		<br>

		<blockquote>Passer 4 heures sur du <strong><mark class="highlight-red">
			<a href="https://www.larousse.fr/dictionnaires/francais/d%C3%A9boguer/21835#:~:text=un%20programme%20informatique.-,d%C3%A9boguer%20v.t.,erreurs%20d&#x27;un%20programme%20informatique.">dÃ©bug</a>
			</mark></strong> dâ€™un logiciel qui nâ€™est pas le notre et se rendre compte que nous nâ€™y arriverons pas, a tendance Ã  rendre <span style="border-bottom:0.05em solid">fou</span> ğŸ¤¯
		</blockquote><br><br>

		<p> Câ€™est ce quâ€™il a du arriver Ã  <a href="https://fr.wikipedia.org/wiki/Solomon_Hykes"><strong>Solomon Hykes</strong></a>,<strong> </strong>un <span style="border-bottom:0.05em solid">franco-amÃ©ricain</span> qui a finit par se demander sâ€™il Ã©tait possible de trouver une <mark class="highlight-teal"><strong>solution</strong></mark> Ã  ce genre de problÃ¨me.
			<br>En rÃ©ponse Ã  cela, il sort <mark class="highlight-blue"><strong>Docker</strong></mark><strong> </strong>le <span style="border-bottom:0.05em solid"><strong>20 mars 2013</strong></span>.
		</p>
		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ¯</span></div><div style="width:100%">Rappel du Wiki de Docker<strong>: Docker est un outil qui peut empaqueter une application et ses dÃ©pendances dans un conteneur isolÃ©.  </strong></div>
		</figure>
		<br>

		<ul class="toggle">
			<li>
				<details close="">
					<summary>âš™ï¸Â Lâ€™Histoire de Docker</summary>
					<ul>
						<li style="list-style-type:disc">Docker a Ã©tÃ© dÃ©veloppÃ© pour un projet interne de <em><strong>dotCloud</strong></em>, une entreprise <span style="border-bottom:0.05em solid">franÃ§aise</span> ğŸ˜Â proposant uneÂ 
							<a href="https://fr.wikipedia.org/wiki/Plate-forme_en_tant_que_service">plate-forme en tant que service</a>.
						</li>
					</ul>
					<ul>
						<li style="list-style-type:disc">Docker est une Ã©volution basÃ©e sur les technologies propriÃ©taires de dotCloud, elles-mÃªmes construites sur des projetsÂ open source ğŸ”“</li>
					</ul>
					<ul>
						<li style="list-style-type:disc">Docker est distribuÃ© en tant que projet <span style="border-bottom:0.05em solid"><em>open source </em></span><em>â¤ï¸</em> Ã  partir de mars 2013.</li>
					</ul>
					<ul>
						<li style="list-style-type:disc">Il s&#x27;agit actuellement du moteur de conteneurisation le plus utilisÃ© ğŸ‘¨â€ğŸ’»</li>
					</ul>
					<ul>
						<li style="list-style-type:disc">En novembre 2019, la sociÃ©tÃ© Docker revend son produit <em>Docker Enterprise</em> Ã  
							<a href="https://www.mirantis.com/?utm_source=google&amp;utm_source=google&amp;utm_medium=paidsearch&amp;utm_medium=paidsearch&amp;utm_campaign=amer-en-brand&amp;utm_campaign=16574635611&amp;utm_content=website&amp;utm_content=604023926849&amp;utm_term=mirantis&amp;utm_term=mirantis&amp;utm_adgroup=131852988902&amp;utm_region=emea&amp;utm_focus=brand&amp;gclid=CjwKCAjw2rmWBhB4EiwAiJ0mtdDxiuDhEe4WvIQN4mH83uZFZPD1xJiaRT9V8UUd4Oe2VxbvA0LvzRoC5zIQAvD_BwE">Mirantis</a>
							, et effectue une levÃ©e de fonds de prÃ¨s de <span style="border-bottom:0.05em solid"><em><strong>35 millions</strong></em></span><em><strong> de dollars </strong></em>ğŸ¥µ
						</li>
					</ul>
				</details>
			</li>
		</ul>

		<br>
		<hr/>
		<br>

		<p>
			Tout Ã§a semble tout beau mais en fait, si Ã§a existe dÃ©jÃ  avec les <a href="https://fr.wikipedia.org/wiki/Machine_virtuelle">VM</a>,
		</p>
		<h3>Pourquoi les dÃ©veloppeurs utilisent Docker ? ğŸ¤”</h3>
		<br>

		<p>
			Le grand avantage de <strong><mark class="highlight-blue">Docker</mark></strong> est la possibilitÃ© de modÃ©liser chaque conteneur sous la forme d&#x27;une image que l&#x27;on peut stocker localement.
		</p>
		<br>

		<p>
			ğŸ”Â Un <span style="border-bottom:0.05em solid"><strong>conteneur</strong></span> est une machine virtuelle sans noyau.</p>
		<p>
			<mark class="block-color-purple_background">ğŸ“ŒÂ Ce que jâ€™appelle <span style="border-bottom:0.05em solid"><strong>noyau</strong></span> est tout lâ€™ensemble du systÃ¨me permettant Ã  la machine virtuelle de fonctionner, lâ€™OS, le cotÃ© graphique, rÃ©seau, etcâ€¦</mark>
		</p>
		<p>ğŸ”Â En dâ€™autres termes, un conteneur ne contient <span style="border-bottom:0.05em solid"><strong>que lâ€™application</strong></span> <em>et</em> <strong><span style="border-bottom:0.05em solid">les dÃ©pendances de lâ€™application</span></strong>.
		</p>
		<br>
		
		<h3><span style="border-bottom:0.05em solid">Docker Hub:</span></h3><br>

		<p>
			<mark class="block-color-yellow_background"><strong><mark class="highlight-blue">Docker</mark></strong> met a disposition une sorte dâ€™App Store, contenant des images (conteneur) de milliers de personnes, simplifiant encore plus son usage ğŸ‘</mark>
		</p>
		<br>

		<p class="block-color-gray">
			Imaginez que vous souhaitiez hÃ©berger un site internet, il vous faudrait par exemple installer <span style="border-bottom:0.05em solid"><strong>NGINX</strong></span>.
		</p>
		<p class="block-color-gray">
			Lâ€™installer sur son ordinateur ? Vous nâ€™auriez pas retenu la leÃ§on ? Et si vous nâ€™aviez pas le bon OS, ou les mauvaises dÃ©pendances ?
		</p>
		<br>

		<p>
			ğŸ¤”Â <mark class="highlight-gray_background">Nous aurions besoin du container Docker qui installe de lui mÃªme NGINX.</mark>
		</p>
		<p>
			ğŸ˜ <mark class="highlight-gray_background">Ca tombe bien, Ã©tant connu, lâ€™image NGINX Ã  Ã©tÃ© publiÃ© par<a href="https://hub.docker.com/_/nginx"><strong> NGINX sur le Docker Hub!</strong></a> ğŸ¥³</mark>
		</p>
		<br>

		<p>
			Regardons un exemple de ce Ã  quoi pourrais ressembler une image NGINX:
		</p>
		<pre class="code">
			<code>
				FROM		alpine:3.12

				RUN			apk update &amp;&amp; apk upgrade &amp;&amp; apk add	\
											openssl			\
											nginx			\
											curl			\
											vim				\
											sudo

				RUN			rm -f /etc/nginx/nginx.conf

				COPY		./config/nginx.conf /etc/nginx/nginx.conf
				COPY		scripts/setup_nginx.sh /setup_nginx.sh

				RUN			chmod -R +x /setup_nginx.sh

				EXPOSE		443

				ENTRYPOINT	[&quot;sh&quot;, &quot;setup_nginx.sh&quot;]
			</code>
		</pre>
		<br>
				
		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ‘‰</span></div><div style="width:100%">Ce fichier est un <span style="border-bottom:0.05em solid"><strong>Dockerfile</strong></span>, câ€™est le nom du fichier principal de vos images <mark class="highlight-blue"><strong>Docker</strong></mark>.<br>Qui dit <span style="border-bottom:0.05em solid"><strong>Dockerfile</strong></span>, dit nouveau language de programmation, mais ne fuyez pas, il sâ€™agit de connaitre ces quelques mots-clefs.
			</div>
		</figure>
		<br>

		<h2>Quelques mots-clefs <span style="border-bottom:0.05em solid">Dockerfile</span>:</h2>
		<h1>
			<details close="">
				<summary><mark class="highlight-blue">FROM</mark></summary>
				<ul class="toggle" style="font-size:0.55em;">
					<div class="indented">
						<p class="block-color-gray">Permet dâ€™indiquer Ã  Docker sous quel OS doit tourner votre machine virtuelle.</p>
						<p class="block-color-gray">Câ€™est le <span style="border-bottom:0.05em solid">premier</span> mot clef de votre Dockerfile et celui ci est <span style="border-bottom:0.05em solid"><strong>obligatoire</strong></span>.</p>
						<p class="block-color-gray">Les plus courants sont <em>debian:buster</em> pour <a href="https://www.debian.org/index.fr.html">Debian</a> ou <em>alpine:x:xx</em> pour <span style="border-bottom:0.05em solid">Linux</span>.</p>
					</div>
				</ul>
			</details>
		</h1>

		<h1>
			<details close="">
				<summary><mark class="highlight-blue">RUN</mark></summary>
				<ul class="toggle" style="font-size:0.55em;">
					<div class="indented">
						<p class="block-color-gray">Permet de lancer une commande sur votre machine virtuelle</p>
						<figure class="block-color-gray_background callout" style="display:flex">
							<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
							<div class="block-color-gray">Lâ€™Ã©quivalent de se connecter en ssh, puis de taper une commande bash, comme : <code>echo â€œHello World!â€,</code> qui afficheraâ€¦.</div>
						</figure>
						<p class="block-color-gray">En gÃ©nÃ©ral, les premiers <strong><mark class="highlight-blue">RUN</mark></strong> fournit dans le Dockerfile consistent Ã  mettre Ã  jour les ressources de votre VM, comme apk, ou encore dâ€™ajouter les utilitaires basiques comme <strong>vim</strong>, <strong>curl</strong> ou <strong>sudo</strong>. </p>
					</div>
				</ul>
			</details>
		</h1>

		<h1>
			<details close="">
				<summary><mark class="highlight-blue">COPY</mark></summary>
				<ul class="toggle" style="font-size:0.55em;">
					<div class="indented">
						<p class="block-color-gray">Vous lâ€™avez ! Cela permet en effet de copier un fichier.</p>
						<blockquote class="block-color-gray">Le copier ? Ã€ partir dâ€™ou ?</blockquote>
						<p class="block-color-gray">Vous indiquez simplement ou se trouve votre fichier Ã  copier Ã  partir du rÃ©pertoire ou se trouve votre Dockerfile, puis la ou vous souhaitez le copier dans votre machine virtuelle.</p>
						<figure class="block-color-gray_background callout" style="display:flex">
							<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
							<div class="block-color-gray" style="width:100%">Une image docker câ€™est un dossier, il contient obligatoirement votre <mark class="highlight-blue"><strong>Dockerfile</strong></mark> Ã  la racine du dossier mais peut aussi contenir un tas dâ€™autres fichiers pour ensuite pouvoir les copier directement dans votre VM.</div>
						</figure>
					</div>
				</ul>
			</details>
		</h1>

		<h1>
			<details close="">
				<summary><mark class="highlight-blue">EXPOSE</mark></summary>
				<ul class="toggle" style="font-size:0.55em;">
					<div class="indented">
						<p class="block-color-gray">Ici, câ€™est une question de rÃ©seau ğŸ“¡</p>
						<p class="block-color-gray">L&#x27;instruction <mark class="highlight-blue"><strong>EXPOSE</strong></mark> informe Docker que le conteneur Ã©coute sur les ports rÃ©seaux spÃ©cifiÃ©s au moment de l&#x27;exÃ©cution. <mark class="highlight-blue"><strong>EXPOSE</strong></mark> ne rend pas les ports du conteneur accessibles Ã  l&#x27;hÃ´te.</p>
						<p class="block-color-gray">Attendez ! Quoi ? Le conteneur Ã©coute sur le port rÃ©seau et n&#x27;est pas accessible Ã  l&#x27;hÃ´te ? </p>
						<p class="block-color-gray">Qu&#x27;est-ce que cela signifie ? ğŸ˜£</p>
						<p class="block-color-gray">L&#x27;instruction <mark class="highlight-blue"><strong>EXPOSE</strong></mark> expose le port spÃ©cifiÃ© et le rend disponible uniquement pour la communication entre conteneurs. Comprenons cela Ã  l&#x27;aide d&#x27;un exemple.</p>
						<p class="block-color-gray">Disons que nous avons deux conteneurs, une application wordpress et un serveur mariadb. Notre application wordpress a besoin de communiquer avec le serveur mariadb pour plusieurs raisons.</p>
						<br>

						<p class="block-color-gray">Pour que l&#x27;application WordPress puisse parler au serveur MariaDB, le conteneur WordPress doit exposer le port. Jetez un Å“il au Dockerfile de l&#x27;image officielle de wordpress et vous verrez une ligne disant <mark class="highlight-blue"><strong>EXPOSE</strong></mark><mark class="highlight-blue"><strong>3306</strong></mark>. C&#x27;est ce qui aide les deux conteneurs Ã  communiquer l&#x27;un avec l&#x27;autre.</p>
						<p class="block-color-gray">Ainsi, lorsque votre conteneur WordPress essaie de se connecter au port <mark class="highlight-blue"><strong>3306</strong></mark> du conteneur MariaDB, c&#x27;est l&#x27;instruction <mark class="highlight-blue"><strong>EXPOSE</strong></mark> qui rend cela possible.</p>
						<p class="block-color-gray">Note : Pour que le serveur WordPress puisse communiquer avec le conteneur MariaDB, il est important que les deux conteneurs soient exÃ©cutÃ©s dans le mÃªme rÃ©seau docker.</p>
					</div>
				</ul>
			</details>
		</h1>

		<h1>
			<details close="">
				<summary><mark class="highlight-blue">ENTRYPOINT</mark></summary>
				<ul class="toggle" style="font-size: 0.55em;">
					<div class="indented">
						<p class="block-color-gray">Youpi ! Votre container semble prÃªt Ã  dÃ©marrer. </p>
						<p class="block-color-gray">Cependant il serait surement plus judicieux de demander au container de lancer une certaine commande au lancement de celui-ci.</p>
						<p class="block-color-gray">Câ€™est ce que permet de faire le mot-clef <mark class="highlight-blue"><strong>ENTRYPOINT</strong></mark> !</p>
						<p class="block-color-gray">Il suffit dâ€™indiquer votre commande, argument par argument, dans le format suivant :</p>
						<blockquote><strong>ENTRYPOINT</strong> <mark class="block-color-gray">â€œbashâ€ , â€-câ€,  â€œ&quot;$(curl </mark><a href="https://grademe.fr/">https://grademe.fr</a><mark class="block-color-gray"> )&quot;â€ ]</mark></blockquote>
					</div>
				</ul>
			</details>
		</h1>
		<br>
		<br>
		<br>

		<p>
			<a href="https://www.nicelydev.com/docker/mots-cles-supplementaires-dockerfile#:~:text=Le%20mot%2Dcl%C3%A9%20EXPOSE%20permet,utiliser%20l&#x27;option%20%2Dp%20."><strong>Ici</strong></a> un site dÃ©taillant les diffÃ©rents types de mots-clefs utilisables dans Docker.
		</p>
		<blockquote>âš ï¸Â Pour continuer vous devez avoir bien compris le principe de Docker.</blockquote>

		<hr/>
		<br>

		<h1>Docker-Compose :</h1>
		<p>
			<mark class="block-color-yellow_background">Maintenant que vous avez compris la rÃ©elle utilitÃ© de Docker, il sâ€™agit de comprendre une fonctionnalitÃ© de <strong><mark class="highlight-blue">Docker</mark></strong> appelÃ©e Compose.</mark>
		</p>
		<br>

		<p>ğŸ“„Â Voici ce quâ€™explique la doc de Docker sur Compose:</p>
		<blockquote>
			<strong><mark class="highlight-blue">Docker Compose</mark></strong> est un <strong>outil qui a Ã©tÃ© dÃ©veloppÃ© pour aider Ã  dÃ©finir et Ã  partager des applications multi-conteneurs.</strong>
			<p>Avec <mark class="highlight-blue"><strong>Compose</strong></mark>, nous pouvons crÃ©er un fichier <mark class="highlight-orange"><strong>YAML</strong></mark> pour dÃ©finir les services et, Ã  l&#x27;aide d&#x27;une seule commande, tout mettre en <mark class="highlight-teal">route</mark> ou tout <mark class="highlight-red">dÃ©monter</mark>.</p>
		</blockquote>
		<br>
	
		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%"><mark class="highlight-blue"><strong>Compose</strong></mark> permettrait donc de gÃ©rer des applications qui utilisent plusieurs containers et de communiquer entre eux.</div>
		</figure>
		<br>

		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div>
			<div style="width:100%"><em><mark class="highlight-gray">Vous devez Ã©galement rendre un Makefile qui doit se trouver Ã  la racine de votre rÃ©pertoire. Il doit permettre de mettre en place toute votre application (câ€™est-Ã -dire build les images Docker via docker-compose.yml)</mark></em>
			</div>
		</figure>
		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div>
			<div style="width:100%">Un texte sur fond bleu comme celui ci est toujours tirÃ© du sujet <strong>dâ€™Inception</strong> de 42.</div>
		</figure>
		<br>

		<p>
			Ici le <mark class="highlight-gray"><em>sujet</em></mark> demande de build les diffÃ©rentes images via un fichier <mark class="highlight-orange"><strong>.yml</strong></mark>, cela tombe bien ce genre de fichier est appelÃ©<mark class="highlight-orange"><strong> YAML</strong></mark>, câ€™est le fameux format indiquÃ© plus haut par la Doc de Docker pour utiliser <strong><mark class="highlight-blue">Docker-Compose</mark></strong>.
		</p>
		<br>

		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div>
			<div style="width:100%"><mark class="highlight-gray">Ce projet consistera Ã  vous faire mettre en place une mini-infrastructure de diffÃ©rents services en suivant des rÃ¨gles spÃ©cifiques.</mark></div>
		</figure>
		<br>
		
		<p>Maintenant câ€™est certain, le projet consiste Ã  relier plusieurs image <mark class="highlight-blue"><strong>Docker</strong></mark>, et pouvoir les lancer ensemble, sans pour autant, quâ€™elles perdent leur indÃ©pendance.</p>
		<p>Tout ca grace Ã  <strong><mark class="highlight-blue">Docker-Compose</mark></strong> qui est prÃ©vu pour ce genre dâ€™utilisation.</p>
		<br>

		<h2>Mais ca dans la vie de tous les jours, câ€™est utile ?</h2>
		<p>En fait, lâ€™utilisation de <mark class="highlight-blue"><strong>Docker-Compose</strong></mark> prend tout son sens dans une infrastructure informatique.</p>
		<br>

		<p>Imaginez, vous lancez votre startup, <mark class="highlight-yellow"><strong>Bana</strong></mark><mark class="highlight-red"><strong>neo</strong></mark>.</p>
		<p>Vous auriez besoin de mettre en place un site internet, vous crÃ©ez votre image NGINX <em><mark class="highlight-gray">(ou vous rÃ©cupÃ©rez celle de NGINX sur le </mark></em><mark class="highlight-blue"><em><strong>DockerHub</strong></em></mark><em><mark class="highlight-gray">).</mark></em></p>
		<p>Vous avez dÃ©sormais un site internet fonctionnel pour votre entreprise.</p>
		
		<blockquote class="block-color-gray_background">
				<mark class="highlight-gray">Ã‰videmment cela risque de prendre plus de temps que 2 phrases Ã  mettre en place ğŸ¤£</mark> 
		</blockquote>

		<p>Maintenant que <mark class="highlight-yellow"><strong>Bana</strong></mark><mark class="highlight-red"><strong>neo</strong></mark> compte une dizaine dâ€™employÃ©s, il serait sympa de mettre en place une badgeuse ğŸªª Ã  lâ€™entrÃ©e pour Ã©viter trop de travail Ã  Manu ğŸ‘®ğŸ»â€â™‚ï¸ de la sÃ©curitÃ©.</p>
		<br>

		<p>Vous crÃ©ez donc une nouvelle image <strong><mark class="highlight-blue">Docker</mark></strong>, spÃ©cialement conÃ§ue pour enregistrer vos salariÃ©s dans une <em><strong><mark class="highlight-orange">base de donnÃ©es </mark></strong></em>et Ã©tant reliÃ©e directement Ã  votre <span style="border-bottom:0.05em solid"><em>badgeuse</em></span>.</p>
		<p>Vous dÃ©ployez Ã©galement rapidement une autre image gÃ©rant un site internet <a href="http://intra.Bananeo.fr">intra.Bananeo.fr</a> permettant Ã  vos salariÃ©s de gÃ©rer leurs heures de travail.</p>
		<br>

		<p>Et Yop ! Tout fonctionne. Mais votre badgeuse ne communique jamais avec le site de lâ€™intra, et il serait sympa de pouvoir prÃ©ciser Ã  vos employÃ©s leurs retards, surtout pour Ã‰ric qui trouve toujours la bonne excuse depuis 2 semaines.</p>
		<br>
		<br>

		<h3>Câ€™est la quâ€™intervient <span style="border-bottom:0.05em solid">Compose</span>! </h3>
		<br>

		<p>Vous allez mettre en place un fichier <mark class="highlight-orange"><strong>.yml</strong></mark>, rappelez vous que câ€™est le format <mark class="highlight-orange"><strong>YAML</strong></mark> qui permet de donner les instructions Ã  <mark class="highlight-blue"><strong>Compose</strong></mark> sur comment gÃ©rer ces diffÃ©rentes images.</p>
		<br>

		<p>Regardons de plus prÃ¨s comment pourrait sâ€™Ã©crire le fichier <mark class="highlight-orange"><strong>.yml</strong></mark> de <mark class="highlight-yellow"><strong>Bana</strong></mark><mark class="highlight-red"><strong>neo </strong></mark><strong>:</strong></p>

		<pre class="code">
			<code>
				version: &quot;3&quot;

					services:       # prÃ©cise les diffÃ©rents services (images) Ã  utiliser 
					nginx:
						build: requirements/website/ 
						env_file: .env          # indique le fichier optionnel contenant l&#x27;environnement
						container_name: website # Le nom du container ( doit porter le meme nom que le service d&#x27;apres le sujet )
						ports:
						- &quot;80:80&quot;             # le port, dÃ©taillÃ© juste en dessous
						restart: always         # Permet de redÃ©marrer automatiquement le container en cas de crash
					nginx:
						build: requirements/intra/
						env_file: .env
						container_name: intra
						ports:
						- &quot;80:80&quot;
						restart: always 
					mariadb:
						container_name: badgeuse
						build: mariadb
						env_file: .env
						restart: always
			</code>
		</pre>
		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ˜†</span></div>
			<div style="width:100%"><mark class="highlight-gray">Non, ce docker-compose.yml ne fonctionne pas sur Inception.</mark>
			</div>
		</figure>
		<br id="sujet" class="sujet">
		
		<p>Ce fichier<mark class="highlight-orange"> </mark><strong><mark class="highlight-orange">.yml </mark></strong>permet de donner les instructions Ã  <strong><mark class="highlight-blue">Compose</mark></strong> pour gÃ©rer 3 images mariadb, NGINX et WordPress.</p>
		<p>
			Tel un <mark class="highlight-blue"><strong>Dockerfile</strong></mark> qui doit obligatoirement commencer par <mark class="highlight-blue"><strong>FROM</strong></mark> suivi de la version, votre fichier <strong><mark class="highlight-orange">YAML</mark></strong> doit commencer par la version de <mark class="highlight-blue"><strong>Compose</strong></mark>, rÃ©fÃ©rerez vous aux 
			<a href="https://docs.docker.com/compose/compose-file/compose-file-v3/">versions actuelles</a>.
		</p>
		<br>

	<!----------------------------------------------------------------- 2. COMPRENDRE LE SUJET ------------------------------------------------------------------>

	<h1>2. Comprendre le sujet:</h1>
	<br>
	<br>

		<ul class="toggle">
			<li>
				<details close="">
					<summary><mark class="highlight-yellow_background">SUJET Ã€ TÃ‰LÃ‰CHARGER</mark></summary>
					<figure>
						<div class="source"><a href="Inception/subject.pdf">https://s3-us-west-2.amazonaws.com/secure.notion-static.com/728c9e20-e3a5-4029-b834-c39900551e63/subject.pdf</a></div>
					</figure>
				</details>
			</li>
		</ul>
		<br>

		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div>
			<div style="width:100%"><mark class="highlight-gray">Chaque service devra tourner dans un container dÃ©diÃ©.</mark></div>
		</figure>

		<hr/>
		<br>

		<p>
			<mark class="highlight-yellow_background">Voici les diffÃ©rents containers Ã  mettre en place dâ€™aprÃ¨s le sujet :</mark>
		</p>
		<ul class="to-do-list">
			<li>
				<div class="checkbox checkbox-off"></div>
				<span class="to-do-children-unchecked">NGINX <mark class="highlight-gray"><em>(avec TLS v1.2)</em></mark></span>
			</li>
		</ul>
		<ul class="to-do-list">
			<li>
				<div class="checkbox checkbox-off"></div>
				<span class="to-do-children-unchecked">WordPress <em><mark class="highlight-gray">(avec php-fpm configurÃ©)</mark></em></span>
			</li>
		</ul>
		<ul class="to-do-list">
			<li>
				<div class="checkbox checkbox-off"></div>
				<span class="to-do-children-unchecked">MARIADB <mark class="highlight-gray"><em>(sans NGINX)</em></mark></span>
			</li>
		</ul>
		<br>

		<p>
			<mark class="highlight-yellow_background">Voici les deux volumes Ã  mettre en place dâ€™aprÃ¨s le sujet :</mark>
		</p>
		<ul class="to-do-list">
			<li>
				<div class="checkbox checkbox-off"></div>
				<span class="to-do-children-unchecked">Volume contenant votre <strong>base de donnÃ©es WordPress</strong></span>
			</li>
		</ul>
		<ul class="to-do-list">
			<li>
				<div class="checkbox checkbox-off"></div>
				<span class="to-do-children-unchecked">Volume contenant les <strong>fichiers</strong> de votre <strong>site WordPress</strong></span>
			</li>
		</ul>
		<br>
		
		<blockquote>
			Ces volumes doivent Ãªtre disponibles Ã  partir du dossier <code><em><strong>/home/</strong></em></code><code><mark class="highlight-gray"><em><strong>&lt;login&gt;</strong></em></mark></code><code><em><strong>/data</strong></em></code> de la machine hÃ´te utilisant <strong><mark class="highlight-blue">Docker</mark></strong>.
		</blockquote>
		<br>

		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">Les volumes <mark class="highlight-blue"><strong>Compose</strong></mark> prÃ©sentent plusieurs avantages comme pouvoir Ãªtre gÃ©rÃ©s Ã  l&#x27;aide des commandes de la CLI de Docker ou de son API ou encore pouvoir Ãªtre partagÃ©s de maniÃ¨re plus sÃ»re entre plusieurs conteneurs. 
				<br>
				<br>
				<em><a href="https://docs.docker.com/storage/volumes/">+ dâ€™info sur la doc de Docker ici</a></em></div>
		</figure>
		<br>

		<p>
			<mark class="highlight-yellow_background">Nous devrons Ã©galement mettre en place :</mark>
		</p>
		<ul class="to-do-list">
			<li>
				<div class="checkbox checkbox-off"></div>
				<span class="to-do-children-unchecked">UnÂ <a href="https://docs.docker.com/engine/reference/commandline/network/"><span style="border-bottom:0.05em solid"><em><strong>docker-network</strong></em></span></a>Â qui fera le lien entre vos containers.</span>
			</li>
		</ul>
		<br>

		<p>
			<mark class="highlight-yellow_background">Les utilisateurs Ã  crÃ©er dans notre base de donnÃ©es WordPress:</mark>
		</p>
		<ul class="to-do-list">
			<li>
				<div class="checkbox checkbox-off"></div>
				<span class="to-do-children-unchecked">Un utilisateur <strong>Admin</strong> <mark class="highlight-gray">(ne doit pas sâ€™appeler admin)</mark></span>
			</li>
		</ul>
		<ul class="to-do-list"><li><div class="checkbox checkbox-off"></div> <span class="to-do-children-unchecked">Un utilisateur standard</span></li></ul>
		<br>

		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div>
			<div style="width:100%">Pour des questions de lisibilitÃ©, il faudra configurer notre nom de domaine afin quâ€™il pointe vers <strong>notre adresse IP locale</strong>. Ce nom de domaine sera <span style="border-bottom:0.05em solid"><mark class="highlight-gray"><em>&lt;login&gt;</em></mark></span><span style="border-bottom:0.05em solid">.42.fr</span></div>
		</figure>
		<br>

		<hr/>
		<br>
		
		<h3>Afin de rÃ©aliser ces diffÃ©rentes tÃ¢ches, le sujet apporte plusieurs autres prÃ©cisions :</h3>
		<br>

		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div>
			<div style="width:100%">Le tag latest est <span style="border-bottom:0.05em solid"><strong>interdit</strong></span>.</div>
		</figure>

		<p>
			Lorsque vous prÃ©cisez une dÃ©pendance Ã  installer, vous devez prÃ©ciser sa version Ã  installer, lâ€™avantage du tag <strong><mark class="highlight-gray"><em>latest</em></mark></strong> est clair, installer la <strong>derniÃ¨re version</strong> dâ€™une dÃ©pendance.
		</p>
		<p>
			Cependant <mark class="highlight-gray"><em><strong>latest</strong></em></mark> a Ã©galement un <span style="border-bottom:0.05em solid">gros dÃ©savantage</span>, il peut apporter des <strong>problÃ¨mes de compatibilitÃ©</strong> sur le temps.
		</p>
		<p>
			<strong><span style="border-bottom:0.05em solid"><mark class="highlight-gray">Exemple:</mark></span></strong><mark class="highlight-gray"> Aujourd&#x27;hui vous pourriez tout configurer de maniÃ¨re a ce que les derniÃ¨res versions fonctionnent correctement entre elles, mais imaginez que 2 ans aprÃ¨s quelqu&#x27;un souhaite tester votre logiciel, il se pourrait que certaines dÃ©pendances aient Ã©voluÃ©es et fonctionnent autrement entre elles, câ€™est pour cela quâ€™il est prÃ©fÃ©rable dâ€™indiquer la version Ã  utiliser.</mark>
		</p>
		<br>

		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div>
			<div style="width:100%">Aucun mot de passe ne doit Ãªtre prÃ©sent dans vos <mark class="highlight-blue"><strong>Dockerfiles</strong></mark>.</div>
		</figure>

		<p>Faut-il vraiment expliquer ce point la ? ğŸ˜…</p>
		<p>Il faut dire que c&#x27;est une des plus grosses erreurs des devs utilisant Github.</p>
		<p>Oui, il arrive que des dÃ©veloppeurs push dans leur repo certaines informations sensibles, telles que des clefs dâ€™API ou encore des mots de passe en clair ğŸ«¢</p>
		<p>Ã‰videmment Ã§a reste <span style="border-bottom:0.05em solid"><strong>lâ€™erreur number 1</strong></span> Ã  ne pas faire. </p>
		<p>Si cela vous arrive, ne faites pas la deuxiÃ¨me erreur de re-push par dessus en supprimant votre clef ou votre mot de passe, les commits de Github finiront par vous trahir âŒ</p>
		<p>Pensez plutÃ´t Ã  rapidement <a href="https://makina-corpus.com/devops/git-annuler-proprement-un-commit-apres-un-push">supprimer votre commit</a>.</p>
		<br>

		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div>
			<div style="width:100%">Lâ€™utilisation des variables dâ€™environnement est <span style="border-bottom:0.05em solid"><strong>obligatoire</strong></span>.</div>
		</figure>
		<p>Cette consigne va avec la prÃ©cÃ©dente, vous devez donc utiliser lâ€™environnement de votre machine.</p>
		<p>Cela pourrait sembler utile pour stocker les mots de passe ou autres</p>
		<br>
		
		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div>
			<div style="width:100%">La mise en place dâ€™un fichier <span style="border-bottom:0.05em solid"><strong>.</strong></span><em><span style="border-bottom:0.05em solid"><strong>env</strong></span></em> afin de stocker vos variables dâ€™environnement est <span style="border-bottom:0.05em solid"><strong>fortement conseillÃ©e</strong></span>.</div>
		</figure>
		<p>Nous savons dÃ©sormais comment stocker notre environnement.</p>
		<br>
		<br>

		<p>Dans le sujet, nous trouvons Ã©galement un exemple dâ€™a quoi pourrait ressembler ce fichier .env grace Ã  un <code><em>cat srcs/.env</em></code> :</p>
		<pre class="code">
			<code>
				DOMAIN_NAME=wil.42.fr
				# certificates
				CERTS_=./XXXXXXXXX
				# MYSQL SETUP
				MYSQL_ROOT_PASSWORD=XXXXXXXXXX
				MYSQL_USER=XXXXXXXXXX
				MYSQL_PASSWORD=XXXXXXXXXX
				[...]
			</code>
		</pre>

		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">Grace Ã  ce <code>cat</code> nous pouvons imaginer les infos dont nous aurons besoin pour mettre en place notre projet.</div>
		</figure>
		<br>
		<br>

		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div>
			<div style="width:100%">Votre container <strong>NGINX</strong> doit Ãªtre le seul point dâ€™entrÃ©e de votre infrastructure par le port <strong>443</strong> uniquement en utilisant le protocole <strong>TLSv1.2</strong> ou <strong>TLSv1.3</strong></div>
		</figure>
		<p>Le seul point dâ€™entrÃ©e de notre Compose doit Ãªtre par le container de NGINX, passant par le port <strong>443</strong>.</p>
		<p>Câ€™est Ã  dire que le seul porte quâ€™ouvrira Docker-Compose sur votre machine sera le <strong>443</strong> <mark class="highlight-gray"><em>(tips: câ€™est le port qui permet lâ€™accÃ¨s par https:// , et le 80 par http://)</em></mark></p>
		<p>Ce <em><strong>schÃ©ma</strong></em> fournit dans le sujet devrait <span style="border-bottom:0.05em solid">Ã©claircir</span> les choses:</p>

		<div class="schema-sujet">
			<figure class="image">
				<a href="img/Capture_dcran_2022-07-19__16.24.51.png"><img style="width:1012px" src="img/Capture_dcran_2022-07-19__16.24.51.png"/></a>
			</figure>
		</div>

		<p>
			Ici, on retrouve les ports qui permettront Ã  <strong>WordPress</strong> de communiquer en interne avec la base de donnÃ©es <mark class="highlight-gray">(pour pouvoir stocker des nouvelles pages ou autres)</mark> et <strong>NGINX</strong> qui communique avec <strong>WordPress</strong> <mark class="highlight-gray">(qui lui dira quoi afficher sur le serveur web).</mark>
		</p>
		<p>
			Le container <strong>MariaDB</strong> stocke ses informations <mark class="highlight-gray"><em>(base de donnÃ©e)</em></mark> dans le volume correspondant et <strong>WordPress</strong> <em><mark class="highlight-gray">(site wordpress)</mark></em> dans le sien.
		</p>
		<br>

		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">Il est indiquÃ© que nous devons utiliser le protocole <strong>TLSv1.2</strong> ou <strong>TLSv1.3</strong></div>
		</figure>
		<br>

		<h3>Mais quâ€™est ce que <span style="border-bottom:0.05em solid"><em><strong>TLS</strong></em></span> ?</h3>
		<br>
		<p>
			<mark class="block-color-yellow_background"><span style="border-bottom:0.05em solid"><strong>WikipÃ©dia</strong></span> nous indique : </mark>
		</p>
		<p>
			LaÂ <em><strong>Transport Layer Security </strong></em><em>(</em><em><strong>TLS</strong></em><em>) </em>ou Â«Â SÃ©curitÃ© de la couche de transportÂ Â» est un protocole
			<a href="https://fr.wikipedia.org/wiki/Transport_Layer_Security#cite_note-1"></a>de sÃ©curisation des Ã©changes par 
			<a href="https://fr.wikipedia.org/wiki/R%C3%A9seau_informatique">rÃ©seau informatique</a>, notamment par 
			<a href="https://fr.wikipedia.org/wiki/Internet">Internet</a>.
		</p>
		<br>
		
		<p>TLS permet :</p>
		<ul class="bulleted-list">
			<li style="list-style-type:disc">l&#x27;authentification du serveur</li>
		</ul>
		<ul class="bulleted-list">
			<li style="list-style-type:disc">laÂ confidentialitÃ©Â des donnÃ©es Ã©changÃ©es<mark class="highlight-gray"><em> (ou sessionÂ chiffrÃ©e)</em></mark></li>
		</ul>
		<ul class="bulleted-list">
			<li style="list-style-type:disc">l&#x27;intÃ©gritÃ©Â des donnÃ©es Ã©changÃ©es</li>
		</ul>
		<ul class="bulleted-list">
			<li style="list-style-type:disc">de maniÃ¨re optionnelle, l&#x27;authentificationÂ du client <em><mark class="highlight-gray">(mais dans la rÃ©alitÃ© celle-ci est souvent assurÃ©e par la couche applicative)</mark></em></li>
		</ul>
		<br>

		<p>
			Je ne sais pas vous mais <strong>TLS</strong> me semble ressembler de trÃ¨s prÃ¨s a du <strong>SSL</strong>, ce fameux protocole qui rajoute un <strong><mark class="highlight-teal">cadenas vert</mark></strong> quand vous accÃ©dez Ã  un site <mark class="highlight-teal"><strong>sÃ©curisÃ©</strong></mark>, comme la plupart des sites aujourd&#x27;hui.
		</p>
		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">Câ€™est ce protocole qui change vos <strong>URL</strong> de <em>http</em> en <em>https</em>.</div>
		</figure>
		<br>

		<p>Ma question est donc rapidement,</p>
		<h3>Quelle est la diffÃ©rence entre <mark class="highlight-teal">TLS</mark> et <mark class="highlight-teal">SSL</mark> ?</h3>
		<br>

		<p>
			<strong>SSL</strong> et <strong>TLS</strong> sont deux protocoles qui permettent lâ€™authentification, et le chiffrement des donnÃ©es qui transitent entre des serveurs.
		</p>
		<br>

		<p>
			En fait le <strong>SSL</strong> est le prÃ©dÃ©cesseur du <strong>TLS</strong>. Au fil du temps, de nouvelles versions de ces protocoles ont vu le jour pour faire face aux vulnÃ©rabilitÃ©s et prendre en charge des suites et des algorithmes de chiffrement toujours plus forts, toujours <span style="border-bottom:0.05em solid">plus sÃ©curisÃ©s</span> ğŸ”
		</p>
		<br>

		<h3>Lâ€™histoire du SSL/TSL :</h3>
		<br>
		
		<p>Initialement dÃ©veloppÃ© par <strong>Netscape</strong>, le SSL sort en <strong>1995</strong> dans sa version SSLÂ 2.0 <em><mark class="highlight-gray">(le SSLÂ 1.0 nâ€™Ã©tant jamais sorti)</mark></em>.</p>
		<p>Mais aprÃ¨s la dÃ©couverte de plusieurs vulnÃ©rabilitÃ©s ğŸ”“Â en <strong>1996</strong>, la versionÂ 2.0 est vite remplacÃ©e par le SSLÂ 3.0.Â </p>
		<br>

		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%"><em><mark class="highlight-gray">Les versionsÂ 2.0 et 3.0 sont parfois libellÃ©es ainsiÂ : SSLv2 et SSLv3.</mark></em></div>
		</figure>
		<br>

		<p>
			BasÃ© sur le SSLÂ 3.0,Â <a href="https://tools.ietf.org/html/rfc2246">le TLS est introduit</a> en <strong>1999</strong> comme <strong><em><span style="border-bottom:0.05em solid">la nouvelle version du SSL.</span></em></strong>
		</p>
		<p>
			Le protocole <strong>TSL</strong> est donc simplement le <span style="border-bottom:0.05em solid"><strong>remplaÃ§ant du SSL</strong></span>. Il corrige certainesÂ <strong><mark class="highlight-red"><em><span style="border-bottom:0.05em solid">vulnÃ©rabilitÃ©s de sÃ©curitÃ©</span></em></mark></strong> dans les anciens protocoles <strong>SSL</strong>.
		</p>
		<br>

		<p>Nous devrons donc rendre notre systÃ¨me sÃ©curisÃ©, par un protocole semblable au SSL, le <mark class="highlight-teal"><strong>TSL</strong></mark>. </p>
		<br>

		<hr/>
		<br>
		
		<p>
			Avant de commencer notre projet, regardons le dernier document fourni avec le sujet, la <span style="border-bottom:0.05em solid"><strong>structure attendue de notre projet</strong></span> : 
		</p>
		
		<pre class="code">
			<code>
				$&gt; ls -alR

				total XX
				drwxrwxr-x 3 wil wil 4096 avril 42 20:42 .
				drwxrwxrwt 17 wil wil 4096 avril 42 20:42 ..
				-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 Makefile
				drwxrwxr-x 3 wil wil 4096 avril 42 20:42 srcs

				./srcs:
				total XX
				drwxrwxr-x 3 wil wil 4096 avril 42 20:42 .
				drwxrwxr-x 3 wil wil 4096 avril 42 20:42 ..
				-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 docker-compose.yml
				-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 .env
				drwxrwxr-x 5 wil wil 4096 avril 42 20:42 requirements

				./srcs/requirements:
				total XX
				drwxrwxr-x 5 wil wil 4096 avril 42 20:42 .
				drwxrwxr-x 3 wil wil 4096 avril 42 20:42 ..
				drwxrwxr-x 4 wil wil 4096 avril 42 20:42 bonus
				drwxrwxr-x 4 wil wil 4096 avril 42 20:42 mariadb
				drwxrwxr-x 4 wil wil 4096 avril 42 20:42 nginx
				drwxrwxr-x 4 wil wil 4096 avril 42 20:42 tools
				drwxrwxr-x 4 wil wil 4096 avril 42 20:42 wordpress

				./srcs/requirements/mariadb:
				total XX
				drwxrwxr-x 4 wil wil 4096 avril 42 20:45 .
				drwxrwxr-x 5 wil wil 4096 avril 42 20:42 ..
				drwxrwxr-x 2 wil wil 4096 avril 42 20:42 conf
				-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 Dockerfile
				-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 .dockerignore
				drwxrwxr-x 2 wil wil 4096 avril 42 20:42 tools
				[...]

				./srcs/requirements/nginx:
				total XX
				drwxrwxr-x 4 wil wil 4096 avril 42 20:42 .
				drwxrwxr-x 5 wil wil 4096 avril 42 20:42 ..
				drwxrwxr-x 2 wil wil 4096 avril 42 20:42 conf
				-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 Dockerfile
				-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 .dockerignore
				drwxrwxr-x 2 wil wil 4096 avril 42 20:42 tools
			</code>
		</pre>
		<br>

		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">Ã‰vitons de nÃ©gliger ce genre dâ€™information fournie avec le sujet, elle peut dÃ©jÃ  nous aider Ã  <span style="border-bottom:0.05em solid">dÃ©marrer</span> le projet.</div>
		</figure>
		<br>
		
		<p>
			Cette structure nous montre clairement quâ€™il doit y avoir un dossier principal <code>srcs</code> contenant notre fameux <strong><mark class="highlight-orange">docker-compose.yml </mark></strong>que nous avons vu juste au dessus, notre fichier <strong><mark class="highlight-teal">.env</mark></strong>, ainsi quâ€™un dossier <code>requirements</code> qui contiendra nos diffÃ©rents containers.
		</p>
		<br>

		<p>Rappel des <span style="border-bottom:0.05em solid"><strong>3 containers </strong></span>Ã  mettre en place : </p>
		<ul class="to-do-list">
			<li>
				<div class="checkbox checkbox-off"></div>
				<span class="to-do-children-unchecked"><strong>NGINX</strong> <mark class="highlight-gray"><em>(avec TLS v1.2)</em></mark></span>
			</li>
		</ul>
		<ul class="to-do-list">
			<li>
				<div class="checkbox checkbox-off"></div>
				<span class="to-do-children-unchecked"><strong>WordPress</strong> <em><mark class="highlight-gray">(avec php-fpm configurÃ©)</mark></em></span>
			</li>
		</ul>
		<ul class="to-do-list">
			<li>
				<div class="checkbox checkbox-off"></div>
				<span class="to-do-children-unchecked"><strong>MARIADB</strong> <mark class="highlight-gray"><em>(sans NGINX)</em></mark></span>
			</li>
		</ul>
		<br>

		<p>Comme je lâ€™expliquais au dÃ©but, chaque container est reprÃ©sentÃ© par un <code>dossier</code> portant son nom.</p>
		<p>
			Dans chaque dossier de container doit obligatoirement se trouver son <strong><mark class="highlight-blue">Dockerfile</mark></strong>, sans quoi <mark class="highlight-blue"><strong>Docker</strong></mark> serait perdu.
		</p>
		<p>
			Rappelez vous, en + du <strong><mark class="highlight-blue">Dockerfile</mark></strong> nous pouvons rajouter diffÃ©rents fichiers/dossiers de config qu&#x27;il serait ensuite intÃ©ressant de copier dans notre container grÃ¢ce au <mark class="highlight-blue"><strong>Dockerfile</strong></mark> et son mot-clef <strong><mark class="highlight-blue">COPY</mark></strong>.
		</p>
		<br>

		<p>Le schÃ©ma fournit avec le sujet nous indique directement quels fichiers il serait intÃ©ressant de fournir avec nos containers, les voici:</p>
		<ul class="bulleted-list">
			<li style="list-style-type:disc">
				Un fichier <em><strong>conf</strong></em> qui pourrait contenir le fichier de configuration du container <mark class="highlight-gray"><em>(la config de NGINX pour son container associÃ© par exemple)</em></mark>
			</li>
		</ul>
		<ul class="bulleted-list">
			<li style="list-style-type:disc">
				Un fichier <em><strong>.dockerignore.</strong></em> Tout comme le fichier <em><strong>.gitignore</strong></em>, il prÃ©cise Ã  <mark class="highlight-blue"><strong>Docker</strong></mark> des fichiers Ã  ne pas regarder, car ils n&#x27;auront surement aucune utilitÃ© pour <mark class="highlight-blue"><strong>Docker</strong></mark>.
			</li>
		</ul>
		<ul class="bulleted-list">
			<li style="list-style-type:disc">
				Un dossier <code>tools</code> permettant surement de stocker les autres outils dont nous pourrions avoir besoin.
			</li>
		</ul>
		<br>
		
		<p>Nous pouvons dÃ©jÃ  reproduire la structure de fichiers demandÃ©e histoire dâ€™y voir plus clair ğŸ¤“</p>
		<br>
		
		<p>Maintenant que nous comprenons ce que le sujet attend de nous, il serait interessant de se demander :</p>

		<hr/>
		<h3>Par oÃ¹ commencer ?</h3>
		<br>
		
		<p>Une fois que nous avons nos <code>dossiers</code> et nos fichiers requis, nous devrions commencer par crÃ©er un des trois containers requis.</p>
		<br>

		<figure class="block-color-gray_background callout" style="display:flex" id="nginx">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">Inutile de sâ€™attaquer Ã  la partie <mark class="highlight-blue"><strong>Compose</strong></mark> pour lâ€™instant, comment voudriez-vous relier 3 containers entre eux si vous n&#x27;en possÃ©dez aucun?</div>
		</figure>
		<br>
		<br>

	<!----------------------------------------------------------------- 3. CONTAINER NGINX ------------------------------------------------------------------>

	<h1>3. Container NGINX :</h1>
	<br>
	<br>

		<p>CommenÃ§ons par notre container le moins flou, <strong>NGINX</strong>.</p>
		<p><strong>NGINX</strong> permet de mettre en place un <span style="border-bottom:0.05em solid">serveur Web</span>. </p>
		<br>
		
		<p>Nous allons commencer par Ã©tape afin de comprendre au mieux comment utiliser et se balader avec <mark class="highlight-blue"><strong>Docker</strong></mark>.</p>
		<br>

		<p>Ouvrons dâ€™abord le fichier essentiel de Docker, le <mark class="highlight-blue"><strong>Dockerfile</strong></mark> <strong>NGINX. </strong></p>
		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">
				Rappelez-vous quâ€™il existe une image NGINX toute prÃªte, mise Ã  disposition par <strong>NGINX</strong> sur le <mark class="highlight-blue"><strong>Docker Hub</strong></mark>. 
				<br>La plupart des dÃ©veloppeurs serait directement passÃ©e par la, mais ici <em><strong>42</strong></em> nous lâ€™interdit, afin de savoir la recrÃ©er nous mÃªme.
			</div>
		</figure>
		<p>Si vous avez bien suivi, vous devriez savoir quelle ligne Ã©crire en premier, du moins le premier mot clef du Dockerfile.</p>
		<br>

		<ul class="toggle">
			<li>
				<details close="">
					<summary><strong>SPOIL ğŸ”</strong></summary>
					<p>
						Câ€™est <mark class="highlight-blue"><strong>FROM</strong></mark> ! Comme indiquÃ© au dÃ©but du cours, <mark class="highlight-blue"><strong>FROM</strong></mark> permet dâ€™indiquer Ã  Docker sur quel OS nous souhaitons faire tourner notre machine. Câ€™est un mot clef obligatoire et il doit <span style="border-bottom:0.05em solid"><strong>toujours Ãªtre en premier</strong></span> dâ€™un <mark class="highlight-blue"><strong>Dockerfile</strong></mark>.
					</p>
				</details>
			</li>
		</ul>
		<br>

		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div>
			<div style="width:100%"><mark class="highlight-gray">Pour des raisons de performance, les containers devront Ãªtre build au choix : soit sous Alpine Linux avec lâ€™avant-derniÃ¨re version stable, soit sous Debian Buster.</mark></div>
		</figure>
		<p>
			Pour lâ€™OS, nous avons donc le choix entre <em><mark class="highlight-gray">debian:buster</mark></em> ou <mark class="highlight-gray"><em>alpine:X.XX </em></mark><em>(vÃ©rifiez lâ€™avant-derniÃ¨re version stable en date, </em><a href="https://www.alpinelinux.org"><em>ici</em></a><em>).</em>
		</p>
		<br>

		<h2>Quelle diffÃ©rence entre <span style="border-bottom:0.05em solid">Alpine</span> et <span style="border-bottom:0.05em solid">Debian</span>?</h2>
		<br>

		<p>
			<mark class="highlight-orange"><strong>Alpine Linux</strong></mark> est une distribution <strong>Linux</strong> lÃ©gÃ¨re, orientÃ©e sÃ©curitÃ©, elle contient le moins de fichiers et outils possibles afin de laisser la possibilitÃ© au dÃ©veloppeur de les installer par lui mÃªme si besoin.
		</p>
		<p>
			<strong><mark class="highlight-orange">Debian</mark></strong> est le systÃ¨me d&#x27;exploitation universel. Les systÃ¨mes Debian utilisent actuellement le noyau Linux ou le noyau <a href="https://www.freebsd.org/fr/"><strong>FreeBSD</strong></a>.
		</p>
		<br>
		
		<p>
			Pour ma part, Ã©tant plus Ã  lâ€™aise avec ce systÃ¨me, je vais utiliser <mark class="highlight-orange"><strong>Debian</strong></mark><mark class="highlight-gray">.</mark>
		</p>
		<br>
		
		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">La suite du tutoriel est reprÃ©sentÃ© pour <mark class="highlight-orange"><strong>Debian</strong></mark>. Mais vous devriez facilement pouvoir adapter cela sur <strong><mark class="highlight-orange">Alpine</mark></strong>.</div>
		</figure>
		<br>
		
		<p>
			Nous pouvons donc commencer par Ã©crire : <mark class="highlight-brown"><code>FROM debian:buster</code></mark> dans notre <mark class="highlight-blue"><strong>Dockerfile</strong></mark>.
		</p>
		<br>

		<p>Maintenant jâ€™ai envie de vous dire, si cette ligne est la seule ligne obligatoire, notre container pourrait-il dÃ©marrer ?</p>
		<p>Nous avons indiquÃ© un OS Ã  installer, nous devrions pouvoir le lancer.</p>
		<p>
			Le plus sympa, câ€™est que <mark class="highlight-blue"><strong>Docker</strong></mark> peut nous permettre de lancer une <mark class="highlight-gray"><em>â€œmachine virtuelleâ€</em></mark>, mais en lui prÃ©cisant, on peut Ã©galement accÃ©der Ã  son terminal ! Utile pour voir ce quâ€™il yâ€™a dedans ou effectuer nos propres tests.
		</p>
		<br>

		<p>Pour cela, il faut connaitre les commandes indispensables aux containers de Docker.</p>
		<br>

		<hr/>
		<br>

		<h2>Les commandes essentielles dâ€™un container Docker :</h2>
		<br>
		
		<p>Un container <mark class="highlight-blue"><strong>Docker</strong></mark> doit Ãªtre <strong>build</strong> avant dâ€™Ãªtre lancÃ©.</p>
		<p>
			Câ€™est pendant le <strong>build</strong> que vous pourrez obtenir des infos sur des potentielles erreurs que vous auriez fait dans le <mark class="highlight-blue"><strong>Dockerfile</strong></mark>.
		</p>
		<br>

		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">Chaque commande Docker commence par le mot clef <code>docker</code></div>
		</figure>
		<br>
		
		<p>
			<span style="border-bottom:0.05em solid">Build un container Docker :</span> &nbsp &nbsp 
			<code>docker build</code>
		</p>
		<br>

		<p>ğŸ˜µÂ J&#x27;espÃ¨re que vous nâ€™oseriez pas tenter cette commande sans lâ€™avoir parfaitement comprise !</p>
		<p>ğŸ¤ªÂ De toute maniÃ¨re, la commande nâ€™est pas fonctionnelle, docker demande obligatoirement un chemin ou se trouve le Dockerfile de lâ€™image Ã  build. </p>
		<p>Dans notre cas, ce serait <code>docker build srcs/requirements/nginx/</code></p>
		<p>Ou encore plus simple, <code>docker build .</code> en vous trouvant directement dans le dossier NGINX.</p>
		<p>Vous pouvez Ã©galement prÃ©ciser un nom Ã  votre build, avec le flag <code>-t</code></p>
		<p><em>Exemple : </em><code>docker build -t nginx .</code></p>
		<br>

		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">Si vous obtenez une erreur de type <code>Cannot connect to the Docker daemon</code>, vÃ©rifiez que Docker est bien ouvert et <a href="https://docs.docker.com/desktop/windows/troubleshoot/">quâ€™il fonctionne</a>.</div>
		</figure>
		<br>

		<p>
			<span style="border-bottom:0.05em solid">Connaitre les images actuelles <em><mark class="highlight-gray">(aprÃ¨s un build rÃ©ussi) :</mark></em></span>&nbsp &nbsp
			<code>docker image ls</code>
		</p>
		<br>

		<p>ğŸ¥³Â Vous devriez visualiser votre premiÃ¨re image !</p>
		<p>
			ğŸ˜•Â Cependant celle ci nâ€™a pas de nom en dessous de <strong>REPOSITORY, </strong>il est indiquÃ© <mark class="highlight-gray"><em>&lt;none&gt;</em></mark>, meme si on peut relier cette image Ã  son ID prÃ©sent dans la quatriÃ¨me colonne, le sujet nous demande que le nom de lâ€™image porte le nom du container associÃ©, ici <strong>NGINX</strong>.
		</p>
		<p>Et on peut faire cela ! Il suffit simplement de prÃ©ciser quand on build lâ€™image, son nom, grace au flag <code>-t</code></p>
		<br>

		<p>
			<span style="border-bottom:0.05em solid">DÃ©marrer une image </span><span style="border-bottom:0.05em solid"><mark class="highlight-gray"><em>(run)&nbsp</em></mark></span><span style="border-bottom:0.05em solid">:</span> &nbsp &nbsp
			<code>docker run &lt;image_name&gt;</code>
		</p>
		<br>

		<p>ğŸ“ŒÂ Vous devrez indiquer le nom de votre image Ã  run.</p>
		<p>ğŸ‘‰Â En prÃ©cisant <code>-it</code> avant le nom de votre image, vous accÃ©derez directement au terminal de votre container Ã  son lancement.</p>
		<br>

		<p>
			<span style="border-bottom:0.05em solid">Connaitre les containers actuellement lancÃ©s :</span> &nbsp &nbsp
			<code>docker ps</code>
		</p>
		<br>

		<p>ğŸ‘‰Â Vous pouvez mÃªme obtenir les containers Docker stoppÃ©s en rajoutant le flag <code>-a</code></p>
		<br>
		
		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ§·</span></div>
			<div style="width:100%">Jâ€™ai crÃ©Ã© un <em><strong>mini script bash</strong></em> qui permet de build un container en faisant <code>docker build -t inception .</code> . 
				<p>AprÃ¨s avoir rÃ©ussi, il propose de le lancer avec <code>-it</code> , ce qui permet dâ€™accÃ©der directement Ã  la console du container.</p>
				<p>Mettez simplement ce bout de texte dans un fichier <code>execute.sh</code> et exÃ©cutez le avec bash.</p>
				<figure class="source">
					<a href="Inception/use.txt">https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d7c6c85d-8a9e-46e3-8b31-2898d714aa14/use.txt</a>
				</figure>
			</div>
		</figure>
		<br>

		<hr/>
		<br>

		<p>Nous sommes maintenant prÃªt pour tenter de lancer notre mini <mark class="highlight-blue"><strong>Dockerfile</strong></mark>.</p>
		<p>CommenÃ§ons par <strong>build</strong> notre container.</p>
		<p>
			Dans le dossier contenant le <mark class="highlight-blue"><strong>Dockerfile </strong></mark><strong>NGINX</strong> : &nbsp &nbsp
			<code>docker build -t nginx .</code>
		</p>
		<br>

		<p>
			<span style="border-bottom:0.05em solid">Maintenant lanÃ§ons le </span><strong><span style="border-bottom:0.05em solid">container</span></strong><span style="border-bottom:0.05em solid"> que nous venons de </span><strong><span style="border-bottom:0.05em solid">build</span></strong><span style="border-bottom:0.05em solid"> : </span> &nbsp &nbsp
			<code>docker run -it nginx</code>
		</p>
		<br>
 
		<p>
			<strong>â¯ &nbsp &nbsp</strong><code>-it</code>&nbsp permet dâ€™ouvrir le terminal du container Ã  son lancement.
		</p>
		<br>
		<br>
		<br>

		<p><strong>Bienvenue</strong> dans votre container !</p>
		<p>
			Pour <span style="border-bottom:0.05em solid">quitter</span> le terminal dâ€™un<strong> container</strong>, câ€™est un classique, il faut taper &nbsp â€˜<code><strong>exit</strong></code>â€™
		</p>
		<br>

		<p>Si vous faites un &nbsp<code>ls</code> , vous verrez de suite :</p>
		<pre class="code"><code>
				bin   dev  home  lib64	mnt  proc  run	 srv  tmp  var
				boot  etc  lib	 media	opt  root  sbin  sys  usr</code>
		</pre>
		<p>Câ€™est le fameux <span style="border-bottom:0.05em solid">noyau</span> de <strong>Debian!</strong></p>
		<p>En soit, les fichiers permettant au systÃ¨me dâ€™exploitation de fonctionner correctement.</p>
		<br>
		<br>

		<p>Maintenant vous Ãªtes dans votre container, vous pouvez installer ce que vous voulez. </p>
		<p>CommenÃ§ons par mettre Ã  jour <strong><em>apt </em></strong><em>dans le terminal du container</em></p>
		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%"><strong>APT</strong> est un utilitaire de ligne de commande permettant d&#x27;installer, de mettre Ã  jour, de supprimer et de gÃ©rer les paquets deb sur Ubuntu, Debian et les distributions Linux associÃ©es.</div>
		</figure>
		<p>
			<strong>APT</strong> est donc un gestionnaire de paquet pour Debian, pour Ãªtre certain que la version dâ€™<strong>APT</strong> installÃ©e sur ce container connait les derniÃ¨res versions des paquets, nous allons lui demander de vÃ©rifier les mises Ã  jour en utilisant : &nbsp &nbsp <code>apt update</code> &nbsp &nbsp, si tout va bien APT devra rÃ©pondre : <span style="border-bottom:0.05em solid"><strong>All packages are up to date.</strong></span>
		</p>
		<p>Nous pouvons rajouter &nbsp &nbsp<code>apt upgrade</code> &nbsp &nbsp pour installer des Ã©ventuelles mises Ã  jour de paquets trouvÃ©s.</p>
		<br>
		<br>

		<p>
			Maintenant que <strong>APT</strong> connait les derniÃ¨res versions des paquets, nous allons lui demander de directement installer celui qui nous intÃ©resse, <strong>NGINX</strong>. 
		</p>
		<p>Il suffit de taper : &nbsp &nbsp<code>apt install nginx</code></p>
		<br>
		
		<p><span style="border-bottom:0.05em solid">Top !</span> Nous voici dÃ©sormais avec un container qui possÃ¨de <strong>NGINX</strong>. </p>
		<br>

		<p>Mais petit problÃ¨me: si nous fermons notre container, et que nous l'ouvrons Ã  nouveau, <strong>NGINX</strong> a disparu ! ğŸ˜©</p>
		<p>Cela voudrait dire quâ€™il va falloir entrer Ã  chaque ouverture du container dans le terminal pour lâ€™installer Ã  nouveau ? ğŸ˜®â€ğŸ’¨</p>
		<p>Heureusement non, et câ€™est la quâ€™intervient notre <mark class="highlight-blue"><strong>Dockerfile</strong></mark> ğŸ¤©</p>
		<p>Rappelez vous, il existe un mot clef <mark class="highlight-blue"><strong>RUN</strong></mark> qui permet dâ€™indiquer Ã  Docker une commande Ã  rÃ©aliser Ã  la crÃ©ation du container.</p>
		<br>

		<p>
			Nous pourrions donc tout simplement rajouter dans notre <mark class="highlight-blue"><strong>Dockerfile</strong></mark> : 
			&nbsp &nbsp<code>RUN apt install nginx</code><strong>&nbsp &nbsp â¯ installer NGINX</strong>
		</p>

		<ul class="toggle">
			<li>
				<details close="">
					<summary><strong>SPOIL ğŸ”</strong></summary>
					<p>
						Si vous tentez Ã  nouveau un <strong>build</strong> de votre container en rajoutant cela, <strong><mark class="highlight-blue">Docker</mark></strong> indique cette erreur : &nbsp &nbsp <code>E: Unable to locate package nginx</code>
					</p>
					<p>Oui ! Nous avons oubliÃ© de mettre Ã  jour APT juste avant avec la commande &nbsp <code>apt update</code> !</p>
					<p>Rajoutons le juste avant, &nbsp &nbsp<code>RUN apt update</code></p>
				</details>
			</li>
		</ul>
		<br>

		<p>Maintenant notre build va plus loin ! Mais il yâ€™a encore une <strong><mark class="highlight-red">erreur</mark></strong>â€¦</p>
		<p>Vous pouvez remarquer que lâ€™avant derniÃ¨re ligne indique : &nbsp &nbsp<code>Do you want to continue? [Y/n] Abort.</code></p>
		<p>Hein ? Mais oui je veux continuer ! Cependant quand <strong><mark class="highlight-blue">Docker</mark></strong> <strong>build</strong> un container, il nâ€™y a aucun prompt permettant de rÃ©pondre <mark class="highlight-teal"><strong>YES</strong></mark> Ã  cette questionâ€¦</p>
		<p>De toute faÃ§on lâ€™idÃ©e dâ€™un <mark class="highlight-blue"><strong>Dockerfile</strong></mark> câ€™est de pouvoir crÃ©er votre projet sans vous demander votre avis en cours dâ€™installation.</p>
		<p>Comment faire ?</p>
		<br>

		<p>
			<strong>APT</strong> propose une option &nbsp<code>-y</code> &nbsp qui permet de rÃ©pondre automatiquement <mark class="highlight-teal"><strong>YES</strong></mark> Ã  ce genre de question lors de lâ€™installation dâ€™un package. 
		</p>
		<p>Il serait donc une bonne idÃ©e de prendre lâ€™habitude de le rajouter lors de lâ€™ajout de ligne utilisant <strong>APT</strong>, sinon votre container ne pourra pas se crÃ©er.</p>
		<p>Il suffit donc de rajouter un <strong>-y</strong> Ã  la fin de la ligne qui concerne lâ€™installation de <strong>NGINX</strong> par <strong>APT</strong>.</p>
		<p>Cela donne : &nbsp &nbsp<code>RUN apt install nginx -y</code></p>
		<br>
		<br>
		
		<p>Tentons de build Ã  nouveauâ€¦ Ã‡a fonctionne ! </p>
		<p>Vous pouvez dÃ©sormais rentrer dans votre container avec &nbsp &nbsp <code>docker run -it nginx</code> &nbsp &nbsp et vous retrouver Ã  nouveau dans le container, mais cette fois lâ€™installation de N<strong>ginx</strong> est dÃ©jÃ  effectuÃ©e !</p>
		<br>
		
		<p>
			Histoire de pouvoir Ãªtre Ã  lâ€™aise en accÃ©dant au terminal du container, je vais installer <strong>vim</strong> et <strong>curl</strong>. Libre Ã  vous dâ€™installer les packages qui vous semblent utiles : 
		</p>
		<p>&nbsp &nbsp<code>RUN apt install vim -y </code>&nbsp &nbsp</p>
		<p>&nbsp &nbsp<code>RUN apt install curl -y</code>&nbsp &nbsp</p>
		<br>
		<br>
		
		<p>Ok maintenant place au <strong>TSL</strong> !</p>
		<p>Nous allons crÃ©er un dossier, qui permettra de stocker le certificat et la clef pour une <mark class="highlight-teal"><strong>connexion sÃ©curisÃ©e</strong></mark>.</p>
		<p>Rajoutons : &nbsp &nbsp<code>RUN mkdir -p /etc/nginx/ssl</code> </p>
		<br>
		
		<p>
			Il serait Ã©galement important de tÃ©lÃ©charger lâ€™outil principal pour la gestion/crÃ©ation de certificat SSL, <span style="border-bottom:0.05em solid"><strong>OpenSSL</strong></span>
		</p>
		<p>Pour cela, comme les autres packages, nous lâ€™installons avec <strong>apt</strong>.</p>
		<p>&nbsp &nbsp<code>RUN apt install OpenSSL -y</code></p>
		<br>

		<p>
			Ensuite, il va falloir gÃ©nÃ©rer un certificat <strong>SSL</strong> et oui nous utilisons les outils <strong>SSL</strong> afin de crÃ©er un certificat <em><strong>TSL/SSL</strong></em>. 
		</p>
		<p>La commande est un peu longue, commenÃ§ons par le mot clef <strong>openssl</strong> puis <strong>req</strong>.</p>
		<p>&nbsp &nbsp<code>openssl req </code></p>
		<br>

		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">La commande <strong>req</strong> crÃ©e et traite principalement des demandes de certificats au format PKCS#10. Elle peut en outre crÃ©er des certificats auto-signÃ©s.</div>
		</figure>
		<br>

		<p>Nous rajouterons ensuite le mot clef <em><strong>-x509</strong></em> pour prÃ©ciser le type du certificat.</p>
		<p> &nbsp &nbsp<code>openssl req -x509</code></p>
		<br>

		<p>
			Maintenant si nous crÃ©ons notre certificat, OpenSSL nous demandera un mot de passe, et souvenez vous, si on demande quelque chose Ã  saisir dans le dÃ©marrage du container, celui-ci ne va pas pouvoir se <strong>build</strong>. Il faut donc Ã©viter cela Ã  tout prix ! 
		</p>
		<br>

		<p>Heureusement, <strong>OpenSSL</strong> a prÃ©vu le coup, avec lâ€™option <strong>-nodes</strong>, notre clef privÃ©e se retrouvera simplement sans mot de passe.</p>
		<p>&nbsp &nbsp<code>openssl req -x509 -nodes</code></p>
		<br>

		<p>
			Il faut ensuite indiquer Ã  OpenSSL oÃ¹ lâ€™on souhaite stocker le certificat et la clef de notre SSL en rajoutant les options <strong>-out</strong> et <strong>-keyout</strong>
		</p>
		<p>&nbsp &nbsp<code>openssl req -x509 -nodes -out /etc/nginx/ssl/inception.crt -keyout /etc/nginx/ssl/inception.key</code></p>
		<br>
		
		<p>
			Si nous lanÃ§ons cette commande nous risquons dâ€™avoir un <mark class="highlight-red"><strong><em>prompt</em></strong></mark> qui requiert certaines informations pour le certificat. 
		</p>
		<p>Heureusement, OpenSSL a encore prÃ©vu le coup et nous permet de les prÃ©remplir en rajoutant une option appelÃ© &nbsp &nbsp<code>-subj</code> </p>
		<p>
			&nbsp &nbsp<code>openssl req -x509 -nodes -out /etc/nginx/ssl/inception.crt -keyout /etc/nginx/ssl/inception.key -subj &quot;/C=FR/ST=IDF/L=Paris/O=42/OU=42/CN=jcluzet.42.fr/UID=jcluzet&quot;</code>
		</p>
		<br>
		
		<p>Plus quâ€™Ã  rentrer cela prÃ©cÃ©dÃ© dâ€™un &nbsp<code>RUN</code>&nbsp dans notre <mark class="highlight-blue"><strong>Dockerfile.</strong></mark></p>
		<br>

		<p>
			<mark class="highlight-teal"><strong>Bravo !</strong></mark> Votre clef et votre certificat TSL sont dÃ©sormais automatiquement crÃ©Ã©s au dÃ©marrage de votre <span style="border-bottom:0.05em solid"><strong>container</strong></span> !
		</p>
		<br>

		<hr/>
		<br>

		<p> Nous allons ensuite crÃ©er un dossier qui nous permettra de stocker les fichiers de config de NGINX. </p>
		<p>&nbsp &nbsp<code>RUN mkdir -p /var/run/nginx</code></p>
		<br>

		<p>
			DÃ©sormais il faudrait modifier le fichier de <em>configuration</em> de <strong>NGINX</strong> comme on le souhaite. Pour cela, nous pourrions faire des <strong>redirections</strong> de certaines phrases dans le fichier de <em><strong>config</strong></em>, mais nous allons plutÃ´t utiliser le mot clef <mark class="highlight-blue"><strong>COPY</strong></mark> du <mark class="highlight-blue"><strong>Dockerfile</strong></mark>, qui a lâ€™air fait pour Ã§a.
		</p>
		<br>

		<p>
			Nous allons donc prendre le fichier de <em><strong>config</strong></em> de <strong>NGINX</strong> de base et nous le modifierons aprÃ¨s. Il se trouve dans &nbsp &nbsp<code>/etc/nginx/nginx.conf</code>
		</p>
		<figure>
			<div class="source"><a href="Inception/nginx.conf">https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a97aeef6-ffc4-4d2e-835d-36986aacdff5/nginx.conf</a></div>
		</figure>
		<br>

		<p>
			Nous allons le mettre dans un dossier <code>conf</code> , lui mÃªme dans le dossier <code>nginx</code> <mark class="highlight-gray"><em>(pour respecter la structure indiquÃ© dans le sujet)</em></mark>.
		</p>
		<br>

		<p>En rajoutant la ligne :</p>
		<p><strong>&nbsp &nbsp<code>COPY</code></strong><code> conf/nginx.conf /etc/nginx/nginx.conf</code></p>
		<p>
			Le fichier de configuration de <strong>NGINX</strong> devrait Ãªtre remplacÃ© par le notre au dÃ©marrage du container, faisons un test en rajoutant la phrase <mark class="highlight-gray"><em>â€œyes we canâ€</em></mark> en commentaire au dÃ©but de notre fichier <em>nginx.conf</em> dans le dossier <code>conf</code>.
		</p>
		<br>

		<p>
			Si tout va bien, en <em><strong>buildant</strong></em> le container, et en le <strong>lancant</strong>, vous devriez voir votre fichier <em>conf</em> de <strong>NGINX</strong> <span style="border-bottom:0.05em solid">modifiÃ© </span>en y accÃ©dant avec vim par exemple.
		</p>
		<br>

		<p>
			Avant de lancer <strong>NGINX</strong>, il faudrait indiquer Ã  <strong>NGINX</strong> la configuration quâ€™on souhaite utiliser dans le cadre <span style="border-bottom:0.05em solid">dâ€™Inception</span>.
		</p>
		<br>
		
		<hr/>
		<h2>Le fichier de configuration de NGINX:</h2>
		<br>
		
		<p><a href="https://ubiq.co/tech-blog/nginx-ssl-configuration-step-step-details/">Cette page</a> nous aide Ã  paramÃ©trer <strong>NGINX</strong> pour le <strong>ssl</strong>.</p>
		<p>Voici la configuration de base que lâ€™on peut trouver :</p>
		<pre class="code code-wrap">
			<code>
				server {
					listen 443;											â¯ Depuis la version 1.12 de NGINX, il faut prÃ©ciser ssl.
					ssl on;												â¯ Inutile depuis la version 1.12
					ssl_protocols TLSv1 TLSv1.1 TLSv1.2;				â¯ Gardons TLSv1.2 &amp; TLSv1.3
					ssl_certificate /etc/nginx/ssl/bundle.crt;			â¯ Indiquons notre certificat
					ssl_certificate_key /etc/nginx/ssl/private.key;		â¯ et notre clef
					...
				}
			</code>
		</pre>
		<br>
		<p>Le fichier de <strong>config</strong> devient donc :</p>
		<pre class="code code-wrap">
			<code>
				server {
					listen 443 ssl;
					ssl_protocols TLSv1.2 TLSv1.3;
					ssl_certificate /etc/nginx/ssl/inception.crt;
					ssl_certificate_key /etc/nginx/ssl/inception.key;
					...
				}
			</code>
		</pre>
		<br>
		
		<p>Nous avons maintenant la partie <span style="border-bottom:0.05em solid"><strong>SSL/TSL</strong></span> qui fonctionne avec <strong>NGINX</strong>.</p>
		<p>Je vais prÃ©ciser le dossier dâ€™accueil en ajoutant &nbsp &nbsp<code>root /var/www/wordpress;</code> </p>
		<p>Câ€™est le dossier oÃ¹ se trouvera WordPress et donc sa premiÃ¨re page Ã  afficher. </p>
		<p>Je vais Ã©galement prÃ©ciser <span style="border-bottom:0.05em solid">quelle </span>page afficher en premier, dans le cadre de <strong>WordPress</strong> il faut indiquer <strong>index.php</strong>, mais je vais Ã©galement en ajouter dâ€™autres qui me semblent importantes.</p>
		<p>&nbsp &nbsp<code>index index.php index.html index.htm;</code></p>
		<br>
		
		<p>Ã‰tant donnÃ© que la connexion se fera depuis localhost, je lâ€™indique en <strong>server_name :</strong> &nbsp &nbsp<code>server_name localhost;</code> </p>
		<br>
		
		<figure class="block-color-blue_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">âš ï¸</span></div>
			<div style="width:100%">Il faudra changer <code><a href="http://localhost">localhost</a></code> par lâ€™IP &nbsp<code>login.42.fr</code></div>
		</figure>
		<br>
		
		<p>Le fichier de config ressemble maintenant Ã  cela:</p>
		<pre class="code">
			<code>
				server {
					#SSL/TLS Configuration
					listen 443 ssl;
					ssl_protocols TLSv1.2 TLSv1.3;
					ssl_certificate /etc/nginx/ssl/inception.crt;
					ssl_certificate_key /etc/nginx/ssl/inception.key;

					#root and index and server_name
					root /var/www/html;
					server_name localhost;
					index index.php index.html index.htm;
				}
			</code>
		</pre>
		<br>

		<p>Il faut ensuite ajouter des rÃ¨gles sur les locations pour <strong>WordPress</strong>.</p>
		<p>Nous devons d'abord demander Ã  NGINX de renvoyer nâ€™importe quelle requÃªte que nous ne connaissons pas sur un <strong>404</strong> <strong>error</strong>.</p>
		<p>Ce <em><a href="https://stackoverflow.com/questions/57561236/how-nginx-process-404-fallback-in-try-files">topic sur stackoverflow</a></em> explique bien cela. Nous donc ajoutons la rÃ¨gle :</p>
		<pre class="code">
			<code>
				location / {
					try_files $uri $uri/ =404;
				}
			</code>
		</pre>
		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">Pour tous les fichiers, nous essayons dâ€™ouvrir le fichier renseignÃ©, si câ€™est un Ã©chec nous renverrons <strong>404</strong>.</div>
		</figure>
		<br>

		<p>Il nous reste Ã  installer <strong>PHP</strong> pour pouvoir gÃ©rer les requÃªtes <strong>PHP</strong> de <strong>WordPress</strong>.</p>
		<br>
		
		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸš«</span></div>
			<div style="width:100%">Le sujet indique que le PHP doit Ãªtre installÃ© sur le container de <strong>WordPress</strong> et non de NGINX. </div>
		</figure>
		<br>
		
		<p>
			<span style="border-bottom:0.05em solid">Pas de soucis !</span> Nous allons donc simplement prÃ©ciser comment gÃ©rer le <strong>PHP</strong> Ã  <strong>NGINX</strong> et lui indiquer oÃ¹ il faut quâ€™il renvoie notre code <strong>php</strong>.
		</p>
		<pre class="code">
			<code>
				location ~ \.php$ {								# Pour toutes les requetes php
					include snippets/fastcgi-php.conf;
					fastcgi_pass wordpress:9000;				# Comment renvoyer les requetes php sur le port 9000
				}
			</code>
		</pre>
		<br>

		<p>Je vais Ã  prÃ©sent simplement ajouter dans le <mark class="highlight-blue"><strong>Dockerfile</strong></mark> une commande &nbsp<code>chmod</code>&nbsp afin de sâ€™assurer que nous aurons les droits sur ce dont nous avons besoin.</p>
		<p>&nbsp &nbsp<code>RUN chmod 755 /var/www/html</code> <mark class="highlight-gray">(notre root principal)</mark></p>
		<p>&nbsp &nbsp<code>RUN chown -R www-data:www-data /var/www/html</code> <mark class="highlight-gray">(lâ€™utilisateur principal)</mark></p>
		<br>

		<p>
			Maintenant il ne reste plus quâ€™Ã  lancer NGINX, nous utiliserons le mot clef &nbsp<code><strong>CMD</strong></code>  : &nbsp &nbsp<code>CMD [ &quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot; ]</code>
		</p>
		<p>Cela lancera <strong>NGINX</strong> en premier plan pour que le container ne se stop pas.</p>
		<br>

		<p>
			Vous pourriez voir la page dâ€™accueil de NGINX en allant sur <a href="http://localhost">localhost</a>, en utilisant <strong>https</strong> <mark class="highlight-gray">(car vous nâ€™avez pas ouvert le </mark><mark class="highlight-gray"><strong>http</strong></mark><mark class="highlight-gray">).</mark> 
			Il faudrait aussi changer le <strong>root</strong> du fichier de configuration et enlever le &nbsp<code>wordpress:9000</code>&nbsp pour le php, car vous nâ€™avez pas encore le container du PHP <mark class="highlight-gray">(WordPress)</mark>
		</p>
		<br>
		<br>

		<p><span style="border-bottom:0.05em solid"><strong>Un container de terminÃ© ! </strong></span></p>
		<br>

		<p>Par quel container poursuivre ? </p>
		<p>Nous aurons besoin de <strong>MariaDB</strong> pour installer <strong>WordPress</strong>.</p>
		<p id="mariadb">Lors de lâ€™installation de <strong>WordPress</strong>, celui ci requiert un serveur web <mark class="highlight-gray">(NGINX)</mark>, et une base de donnÃ©es, ici <strong>MariaDB</strong>.</p>
		<p>Il serait donc plus judicieux de tout comprendre sur les bases de donnÃ©es et commencer par crÃ©er ce container. </p>
		<br>
		<br>
		<br>

	<!----------------------------------------------------------------- 4. CONTAINER MARIADB ------------------------------------------------------------------>

	<h1>4. Container MARIADB :</h1>
	<br>
	<br>

		<p>
			<strong>MariaDB</strong> est un systÃ¨me de gestion de base de donnÃ©es Ã©ditÃ© sous licence GPL. Il s&#x27;agit d&#x27;un embranchement communautaire de <strong>MySQL</strong> : la gouvernance du projet est assurÃ©e par la fondation <strong>MariaDB.</strong>
		</p>
		<br>

		<p>En gros, <strong>MariaDB</strong> est quasiment une copie de <strong>MySQL</strong>, mais pourquoi ?</p>
		<p><strong>MySQL</strong> Ã©tait au dÃ©but totalement <span style="border-bottom:0.05em solid">open-source</span>, puis il a Ã©tÃ© rachetÃ© par <strong>Oracle</strong>.</p>
		<p>Depuis, plusieurs organismes sâ€™inquiÃ¨tent de la possibilitÃ© quâ€™a <strong>Oracle</strong> de rendre <strong><mark class="highlight-red">payant</mark></strong> son logiciel.</p>
		<p>Pour empÃªcher cela, la fondation <strong>MariaDB</strong> crÃ©e une version quasi-identique Ã  MySQL, mais totalement <mark class="highlight-teal"><strong>open-source</strong></mark>. </p>
		<br>
		
		<p><mark class="highlight-yellow_background">Le fonctionnement dâ€™une base de donnÃ©es comme MySQL : </mark></p>
		<p>
			La gestion des donnÃ©es est basÃ©e sur un modÃ¨le de <span style="border-bottom:0.05em solid">tableaux;</span> toutes les donnÃ©es traitÃ©es sur <strong>MySQL</strong> sont stockÃ©es dans des tableaux pouvant Ãªtre <span style="border-bottom:0.05em solid">reliÃ©s les uns aux autres</span> via des clÃ©s. En voici un exemple :
		</p>
		<div class="tableau-mysql">
			<figure>
				<a href="img/mysqlexemple.png"><img style="width:933px" src="img/mysqlexemple.png"/></a>
			</figure>
		</div>
		<br>

		<p>
			<a href="https://www.malekal.com/installer-mysql-mariadb-sur-debian-10/"><em>Ce tutoriel</em></a> indique parfaitement comment crÃ©er une base de donnÃ©es avec <strong>MariaDB</strong> sur <span style="border-bottom:0.05em solid">Debian</span>.
		</p>
		<br>

		<hr/>
		<br>

		<h2>Tutoriel pour utiliser MySQL/MariaDB:</h2>
		<br>

		<p>
			Pour commencer et pouvoir faire vos tests aussi de votre cÃ´tÃ©, nous allons crÃ©er un <strong><mark class="highlight-blue">Dockerfile</mark></strong> minimum pour <strong>MariaDB. </strong>Si vous vous souvenez de ce quâ€™on a fait pour le dÃ©but de <strong>NGINX</strong>, on a simplement besoin de commencer par dâ€™Ã©crire 
			&nbsp <code>FROM debian:buster</code>.
		</p>
		<p>
			Ã€ partir de lÃ , on peut <strong>build</strong> et lancer le container en rentrant dans son terminal <mark class="highlight-gray">(remontez plus haut pour retrouver comment si besoin)</mark>
		</p>
		<p>Maintenant, on se retrouve dans notre container et nous pouvons y effectuer nos commandes tests.</p>
		<br>

		<p>CommenÃ§ons par le fameux, essentiel, &nbsp <code>apt update -y</code>.</p>
		<p>Ajoutons aussi le &nbsp<code>apt upgrade -y</code>.</p>
		<p><strong>APT</strong> contient Ã  prÃ©sent des dÃ©pendances Ã  jour, nous pouvons installer <strong>MariaDB.</strong></p>
		<br>

		<p>La version 10.3 de <strong>MariaDB</strong> Ã©tant la plus commune, nous pouvons lâ€™installer en utiliser <strong>APT</strong>.</p>
		<p>&nbsp &nbsp<code>apt-get install mariadb-server -y</code></p>
		<br>

		<figure class="block-color-gray_background callout" style="display:flex">
			<div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div>
			<div style="width:100%">Pensez au -y, sinon docker aura du mal Ã  <mark class="highlight-blue"><strong>build</strong></mark> votre container car il attendra la confirmation du <strong>y</strong><strong><em>/n</em></strong> â€¦</div>
		</figure>
		<br>

		<p>Rendons ensuite visite au fichier de configuration de MySQL, appelÃ© &nbsp<code>50-server.cnf</code>&nbsp et se trouvant dans &nbsp<code>etc/mysql/mariadb.conf.d/50-server.cnf</code> </p>
		<p>Voici Ã  quoi ressemble le fichier de base :</p>
		<pre class="code">
			<code>
				# The MariaDB configuration file
				#
				# The MariaDB/MySQL tools read configuration files in the following order:
				# 1. &quot;/etc/mysql/mariadb.cnf&quot; (this file) to set global defaults,
				# 2. &quot;/etc/mysql/conf.d/*.cnf&quot; to set global options.
				# 3. &quot;/etc/mysql/mariadb.conf.d/*.cnf&quot; to set MariaDB-only options.
				# 4. &quot;~/.my.cnf&quot; to set user-specific options.
				#
				# If the same option is defined multiple times, the last one will apply.
				#
				# One can use all long options that the program supports.
				# Run program with --help to get a list of available options and with
				# --print-defaults to see which it would actually understand and use.

				#
				# This group is read both both by the client and the server
				# use it for options that affect everything
				#
				[client-server]

				# Import all .cnf files from configuration directory
				!includedir /etc/mysql/conf.d/
				!includedir /etc/mysql/mariadb.conf.d/
			</code>
		</pre>
		<br>

		<p>Ok et si on <em>enlÃ¨ve</em> les commentaires ?</p>
		<pre class="code">
			<code>
				[client-server]
				!includedir /etc/mysql/conf.d/
				!includedir /etc/mysql/mariadb.conf.d/
			</code>
		</pre>
		<br>

		<h3>Le fichier de <span style="border-bottom:0.05em solid">configuration</span> de MariaDB:</h3>
		<br>

		<p>
			Câ€™est donc lâ€™essentiel du fichier de <span style="border-bottom:0.05em solid">config</span> de base, sauf que nous, nous nâ€™avons pas besoin de cette partie qui concerne le cÃ´tÃ© client.
		</p>
		<br>
		
		<p>
			On commence par les crochets &nbsp<code>[mysqld]</code>&nbsp dans le fichier pour indiquer Ã  quelle catÃ©gorie va suivre la configuration suivante (câ€™est comme cela que fonctionne le fichier de configuration de <strong>MySQL</strong>)
		</p>
		<p>Câ€™est ici que nous pouvons prÃ©ciser Ã  <strong>MySQL</strong> sur quel port communiquer, indiquÃ© par le sujet, câ€™est le <strong>3306 ğŸ“¡Â </strong>avec<strong> </strong><code>port = 3306</code></p><p id="323f9edc-073a-4873-baf9-82718a2cea4e" class="">AprÃ¨s, on prÃ©cise Ã©galement que toutes les IP du rÃ©seau peuvent se connecter, pour cela câ€™est la ligne <code>bind_address=*</code> , qui en gros veut dire, <code>bind_address=XXX.XXX.XX.XX</code></p><p id="6417b27c-1969-443a-a71b-193eb14bc696" class="">On peut Ã©galement lui prÃ©ciser notre dossier qui stockera notre base de donnÃ©es avec <code>datadir=/var/lib/mysql</code></p><p id="86061093-55f4-4a38-9096-13624194f4b5" class="">Je rajoute lâ€™utilisateur avec <code>user=mysql</code></p><p id="fc604116-970b-421d-aaf0-67a5f0dd414d" class="">Je ne suis pas sÃ»r que ce soit obligatoire car câ€™est le chemin de base, mais je prÃ©cise Ã©galement oÃ¹ MySQL peut trouver la <strong>socket</strong> pour communiquer avec : <code>socket = /run/mysqld/mysqld.sock</code> </p><p id="40587167-4b8b-4a85-8dde-c878c3a44138" class="">
</p><p id="9c81042d-b2f0-472c-a60e-ea4b9386c3c3" class=""><strong><span style="border-bottom:0.05em solid">Ok good ! </span></strong></p><p id="2c95b79d-776b-421e-bbc0-c5573ff90656" class="">
</p><p id="cb5713cf-9fe4-4d9a-9d79-aa1dcc6078fe" class="">Notre fichier de <span style="border-bottom:0.05em solid">configuration</span> devrait donc Ãªtre :</p><pre id="1f279d11-396b-41a7-8e61-85540a85c1dc" class="code"><code>[mysqld]
datadir = /var/lib/mysql
socket  = /run/mysqld/mysqld.sock
bind_address=*
port = 3306
user = mysql</code></pre><p id="c5c51e51-43b7-4931-9624-12ad52a7f328" class="">
</p><p id="7b2eb343-675a-4b88-b9c5-0865f716c301" class="">Maintenant, il faut enregistrer ce fichier dans notre dossier, dans un dossier <code>conf</code> comme le demande la structure du projet, je lui donne le mÃªme nom, <code>50-server.cnf</code>.</p><p id="98944025-72d6-4c03-9f40-73e87a0536f6" class="">Puis reste Ã  demander au <mark class="highlight-blue"><strong>Dockerfile</strong></mark> de le copier au bon endroit pour le remplacer.</p><p id="62b77808-ade2-4c28-b65a-ac8351011fd4" class="">
</p><pre id="15e0614e-c324-4a19-a4d3-29b3d6f5302a" class="code"><code>COPY conf/50-server.cnf	/etc/mysql/mariadb.conf.d/50-server.cnf</code></pre><p id="334a0dbd-1440-4b74-a0e7-9bb5a1494bdc" class="">
</p><p id="ac478254-5238-4b33-b8a5-297a0e5e8508" class="">Maintenant que <strong>MySQL</strong> est correctement <mark class="highlight-teal"><strong>installÃ©,</strong></mark> il faut crÃ©er une <strong>database</strong> et un <strong>utilisateur</strong> associÃ©.</p><p id="2651a57b-eb58-4d0c-8262-e051a6cfe236" class="">
</p><p id="e55d9515-2d98-4575-8680-958596126760" class="">Pour cela je vais passer par un script que je vais demander au <mark class="highlight-blue"><strong>Dockerfile</strong></mark> dâ€™exÃ©cuter.</p><p id="c668bbf7-b6fb-41a4-be92-ab345397e8ba" class=""><div class="indented"><p id="fb3d9f62-f6f5-4e09-8452-c097c8f366d4" class="">Ce <span style="border-bottom:0.05em solid">script</span> doit crÃ©er avec MySQL le systÃ¨me de table, grÃ¢ce Ã  la commande <code>mysql -e</code></p></div></p><p id="8f3fb161-fa4b-4695-b759-cbdc4f704417" class="">
</p><p id="497c9fb5-8745-410d-b333-1220434af6fe" class="">Dans ce script nous pouvons dâ€™abord <mark class="highlight-teal"><strong>dÃ©marrer</strong></mark> MySQL, sans quoi il sera difficile de le configurer. </p><pre id="500d5526-31f7-46e2-aa0b-c63182f98876" class="code"><code>service mysql start;</code></pre><p id="5eaf38b7-a4c9-415e-be08-d879b4338afa" class=""><strong>â¯ La commande </strong><span style="border-bottom:0.05em solid"><strong>service</strong></span><strong> permet de dÃ©marrer MySQL avec la commande associÃ©e.</strong></p><p id="1fb818a5-1977-4051-8353-1a222c69339c" class="">
</p><p id="0f343083-2994-4e5c-b4e1-76f34b713c03" class="">Ensuite il faut crÃ©er notre table !</p><pre id="94127b3a-a0a6-4d29-aae0-2fbfe66150b0" class="code"><code>mysql -e &quot;CREATE DATABASE IF NOT EXISTS \`${SQL_DATABASE}\`;&quot;</code></pre><p id="38d8d3b1-4c09-47a5-adaf-62ee50b5f56a" class=""><strong>â¯ Je demande de crÃ©er une table si elle nâ€™existe pas dÃ©jÃ , du nom de la variable dâ€™environnement </strong><mark class="highlight-yellow"><strong>SQL_DATABASE</strong></mark><strong>, indiquÃ© dans mon fichier </strong><span style="border-bottom:0.05em solid"><strong>.env</strong></span><strong> qui sera envoyÃ© par le </strong><mark class="highlight-blue"><strong>docker-compose.yml</strong></mark><strong>.</strong></p><p id="9fb4c917-400a-4caa-ac5a-a2a960a7f0be" class="">
</p><p id="09e80eed-b996-416e-a76d-ffd71c51e0ea" class="">Maintenant que la table est crÃ©Ã©e, je vais crÃ©er un utilisateur qui pourra la manipuler.</p><pre id="935d1f0f-3c09-42a8-908c-2743c7fa31d3" class="code"><code>mysql -e &quot;CREATE USER IF NOT EXISTS \`${SQL_USER}\`@&#x27;localhost&#x27; IDENTIFIED BY &#x27;${SQL_PASSWORD}&#x27;;&quot;</code></pre><p id="6b8aad94-0d16-424c-a7b4-ec56f5248c70" class=""><strong>â¯ Je crÃ©e lâ€™utilisateur </strong><mark class="highlight-yellow"><strong>SQL_USER</strong></mark><strong> sâ€™il nâ€™existe pas, avec le mot de passe </strong><mark class="highlight-yellow"><strong>SQL_PASSWORD </strong></mark><strong>, toujours Ã  indiquer dans le </strong><span style="border-bottom:0.05em solid"><strong>.env</strong></span></p><p id="d2ac75cf-c2c6-45d5-80fc-8e56ac439834" class="">
</p><p id="36ff3830-e0ce-4be3-8876-535da8807a74" class="">Maintenant je vais donner tou les droits Ã  cet utilisateur.</p><pre id="cd576499-b998-4901-b341-1acc01ab7575" class="code"><code>mysql -e &quot;GRANT ALL PRIVILEGES ON \`${SQL_DATABASE}\`.* TO \`${SQL_USER}\`@&#x27;%&#x27; IDENTIFIED BY &#x27;${SQL_PASSWORD}&#x27;;&quot;</code></pre><p id="f63f504c-4fb2-498f-bb92-8f8fd53b85ff" class=""><strong>â¯ Je donne les droits Ã  lâ€™utilisateur </strong><mark class="highlight-yellow"><strong>SQL_USER</strong></mark><strong> avec le mot de passe </strong><mark class="highlight-yellow"><strong>SQL_PASSWORD</strong></mark><strong> pour la table </strong><mark class="highlight-yellow"><strong>SQL_DATABASE</strong></mark></p><p id="402de3af-6ee5-4138-b837-02c15cbf2f13" class="">
</p><p id="9d2051dc-9893-4c7f-85f4-73bd517af27f" class="">
</p><p id="27ca5f3f-2232-463f-aa56-9be25f7b7b5a" class="">Maintenant je vais modifier mon utilisateur <strong>root</strong> <del>avec les droits </del><del><a href="http://localhost">localhost</a></del> avec cette commande:</p><pre id="c2867051-6bca-430b-b23a-f59a5cfacd8e" class="code"><code>mysql -e &quot;ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;${SQL_ROOT_PASSWORD}&#x27;;&quot;</code></pre><p id="6b5d4603-3ab5-44a5-9b9d-eec6a4ca36a9" class=""><strong>â¯ Je change les droits root </strong><del><strong>par localhost</strong></del><strong>, avec le mot de passe root </strong><mark class="highlight-yellow"><strong>SQL_ROOT_PASSWORD</strong></mark></p><p id="b1510ecb-7a9f-4bb5-8689-380d59137d8c" class="">
</p><p id="da04873b-f9d5-4590-96b5-ab1bffb06018" class="">Plus quâ€™Ã  rafraichir tout cela pour que MySQL le prenne en compte.</p><pre id="3c855b08-ea0c-4508-8135-b62a600971d4" class="code"><code>mysql -e &quot;FLUSH PRIVILEGES;&quot;</code></pre><p id="4c42e1c1-70ef-478a-8c8d-aa53941b7eab" class=""><strong>â¯ Tout simplement.</strong></p><p id="40070cad-1e5e-4527-ba36-e1468f199d36" class="">
</p><p id="e9a7bd65-4cc0-4f69-bafe-4d377776755d" class="">Il ne nous reste plus quâ€™Ã  redÃ©marrer MySQL pour que tout cela soit effectif !</p><pre id="3dbcae13-725e-4ffb-af3f-0b37e3b14a8f" class="code"><code>mysqladmin -u root -p$SQL_ROOT_PASSWORD shutdown</code></pre><p id="146e2a4c-041f-41c1-b972-2bdb062ba961" class=""><strong>â¯ Je commence dÃ©jÃ  par Ã©teindre MySQL.</strong></p><p id="b471e697-a332-4ae5-8c8f-a2d2f394aab7" class="">
</p><pre id="8fa2d7c1-8b4e-49e1-ae41-f7f388012dc9" class="code"><code>exec mysqld_safe</code></pre><p id="75a7a47d-f7a2-4cd1-afb6-ecb5aa6db7c3" class=""><strong>â¯ Ici je lance la fameuse commande que MySQL recommande sans arrÃªt Ã  son dÃ©marrage. </strong></p><p id="27ac77ad-da68-4e9e-ba95-e566fdd15113" class="">
</p><p id="5d6d10e7-f13e-40c8-a126-e1a979f33748" class="">Mon script qui configure notre base de donnÃ©es est dÃ©sormais fonctionnel et devrait lancer le container <strong>mariadb</strong> sans soucis.</p><p id="489f38dd-1b87-4083-a707-0f4fd9814e6e" class="">Essayons de lancer le container Ã  lâ€™aide dâ€™un : <code>docker build -t mariadb .</code></p><p id="dfacaa07-1eb9-4654-a86d-c5ca16073042" class="">Puis dâ€™un <code>docker run -it mariadb</code></p><p id="38e01515-2c00-4692-a9da-4674f19b3833" class="">Si tout va bien, vous devriez avoir un petit [<mark class="highlight-teal">OK</mark>] qui indique que MySQL Ã  Ã©tÃ© lancÃ© sans problÃ¨me, et si tout va bien, vous devriez Ã©galement avoir une <em><mark class="highlight-red"><strong>erreur</strong></mark></em>!</p><p id="416a904e-e5f0-4dac-a149-cb9f15333ca9" class="">
</p><p id="e29a1050-a779-4acc-ae34-79758db1c7f8" class="">Celle-ci devrait indiquer que vous nâ€™avez indiquÃ© aucun mot de passe, ni dâ€™utilisateur lors de la configuration, normal ! Vous avez indiquÃ© des variables dâ€™environnement et celle-ci seront envoyÃ©es par docker-compose. Vu que vous dÃ©marrez le container seul, il ne trouve pas ces variables.</p><p id="51e29d2a-e254-4d0c-83c5-82d85e2573e7" class="">
</p><p id="wordpress" class="">Rien Ã  faire, si <strong>MySQL</strong> dÃ©marre et indique au moins [<mark class="highlight-teal"><strong>OK</strong></mark>] câ€™est que vous avez terminÃ© cette partie.</p><hr id="98136878-df8c-49d5-bd2f-b0a101a88cc6"/><p id="5c2473a0-b574-4733-9f9e-a6435cd454b5" class=""><br><br>
</p><h2 id="69fdcc86-1dc5-4917-846d-2aa60bfc864d" class="">5. Container WordPress :</h2><p id="da5e39bf-c968-4958-a3bf-8ca12a2e76c5" class="">
</p><p id="cac20d2c-3233-4b38-b78a-1a8038222b3b" class="">Mettons en place <span style="border-bottom:0.05em solid"><strong>WordPress</strong></span>! </p><p id="86f7b4a0-77f9-416f-8f62-d4fbb4b8e0bc" class="">
</p><p id="25823d48-5a43-4d7e-af8e-daad7bdcb982" class="">On a de la chance, <strong>WordPress</strong> est utilisÃ© par plus de <strong>43%</strong> des sites <span style="border-bottom:0.05em solid">dans le monde</span>, câ€™est leur <a href="https://wordpress.com/fr/">page dâ€™accueil</a> qui lâ€™indique. Par consÃ©quent, nous devrions trouver un grand nombre de documentation Ã  son sujet.</p><p id="d9386471-4b50-4902-b1ef-59440cb070d3" class="">
</p><p id="f8f1a4ab-4e7c-44e0-b0a7-2920561f75c6" class="">CommenÃ§ons comme dâ€™habitude par un <mark class="highlight-blue"><strong>Dockerfile</strong></mark> sous <em><strong>debian:buster</strong></em>.</p><p id="20b371e2-ea89-4e5f-97ef-6796c1377df6" class="">Ensuite viens le traditionnel <code>apt-get update</code> et <code>apt-get upgrade</code></p><p id="2552510e-6a49-4a16-942d-7afe8cc53679" class="">
</p><p id="296c3a4c-d376-4669-9222-cc28cfd75c3f" class="">Pour prÃ©voir la suite <mark class="highlight-gray">(nous aurons besoin dâ€™installer WordPress avec son lien de tÃ©lÃ©chargement) </mark>nous devons installer <span style="border-bottom:0.05em solid"><strong>wget</strong></span></p><p id="b2d5bae2-9c10-4dce-a78a-75c27d75f6e9" class="">
</p><pre id="d3d01289-34e1-4a62-9bb9-d089fede92c3" class="code"><code>RUN apt-get -y install wget</code></pre><p id="96a3f817-6ecc-43a1-b85d-128dccf2f88b" class="">
</p><p id="63515327-d686-4b5b-a62c-8e7dc3e9158a" class="">Le sujet nous lâ€™indique, nous devons Ã©galement installer <span style="border-bottom:0.05em solid"><strong>PHP</strong></span> avec <strong>WordPress</strong>.</p><p id="73a0a15b-f9a6-4b7c-a595-bf8d088f9bee" class="">Rappelez vous, il communiquera sur le port <strong>9000</strong> avec <strong>NGINX</strong>.</p><p id="730875de-cd37-42d2-89df-84a63c7eddbf" class="">Pour cela, jâ€™utilise Ã©galement <strong>APT</strong> pour installer <em><strong>php7.3</strong></em> et ses dÃ©pendances comme <em>php-fpm et php-mysql.</em></p><p id="cddcc03e-a888-4738-8cc6-fda8ea10dfcf" class="">
</p>
<pre class="code">
	<code>
		RUN apt-get install -y php7.3\
		php-fpm\
		php-mysql\
		mariadb-client
	</code></pre><p id="52159f3a-dbc3-4160-9fc3-87601c10e1f2" class="">
</p><p id="697ccdce-c383-4f37-b974-186b4f7c94bb" class="">Maintenant il est temps dâ€™installer le fameux <strong>WordPress</strong> dans notre container !</p><p id="a6d383cf-ced6-4614-bee0-03121c97e7ff" class="">Nous utilisons donc <span style="border-bottom:0.05em solid"><em>wget</em></span> en indiquant le lien dâ€™installation. Jâ€™ai pris la version <strong>FR 6.0.</strong> </p><p id="11f07188-b764-41ae-8467-e0f342c1e4f8" class="">Ã€ vous de choisir, vous trouverez les diffÃ©rentes versions <a href="https://fr.wordpress.org/download/releases/">ici</a>.</p><p id="31a3996b-5782-4dee-b394-75b329462cb0" class="">
</p><p id="5587a293-4c7d-4810-9cda-b0d9d5ab2c20" class=""><em>wget</em> possÃ¨de plusieurs options, dont une qui va nous permettre dâ€™indiquer dans quel dossier on veut tÃ©lÃ©charger le fichier en utilisant -P.</p><p id="ca8fb035-d018-43de-aa31-fadd663a619b" class="">Dans quel dossier ? le <strong>/var/www</strong> Ã©videmment ! C&#x27;est ici que nous avons indiquÃ© notre dossier principal Ã  afficher dans le container <strong>NGINX</strong>.</p><p id="e0fb9548-bbbc-4578-85e9-65b957d1d63a" class="">
</p><pre id="059cb4d1-a02a-4a32-abcf-a7232a0807a0" class="code"><code>RUN wget https://fr.wordpress.org/wordpress-6.0-fr_FR.tar.gz -P /var/www</code></pre><p id="5a5c567c-d5d4-4eef-959c-5298224d57ce" class=""><strong>â¯ TrÃ¨s bien, top, mais maintenant il faudrait le dÃ©-tar, enfin le dÃ©compresser quoi. !</strong></p><p id="e9bb0132-82c6-407f-9286-be8c6f531a66" class="">
</p><p id="65f45e7b-1a28-464a-99e0-2394a2d94553" class="">Allez je vous aide, allons dans le dossier <strong>/var/www </strong>et utilisons <code><em><strong>tar -xvf</strong></em></code> suivi du fichier pour le dÃ©compresser et en obtenir le fameux dossier <code>wordpress</code>!</p><p id="80485089-e2f9-48c7-826c-159ceb13c38a" class="">Ensuite on peut supprimer le <em>.tar</em> qui ne sert plus Ã  rien.</p><pre id="002b4c18-6d94-4462-908c-e190ffd4b766" class="code"><code>RUN cd /var/www &amp;&amp; tar -xzf wordpress-6.0-fr_FR.tar.gz &amp;&amp; rm wordpress-6.0-fr_FR.tar.gz</code></pre><p id="d1784ad4-6b36-4851-a484-4631091c5250" class=""><strong>â¯ Nous voila avec </strong><code><strong>wordpress</strong></code><strong> sous forme de dossier.</strong></p><p id="f02a9f3b-9b20-4e11-9a5b-429e61c11171" class="">
</p><p id="c6d5c455-5aa0-404c-97a6-5034f47dcb3f" class="">Maintenant veillons Ã  bien donner les droits Ã  root dâ€™Ã©crire dans ce dossier.</p><pre id="1c5053b3-774a-4edd-a523-f44a6883ff0b" class="code"><code>RUN		chown -R root:root /var/www/wordpress</code></pre><p id="01263021-d31b-4fba-9d9c-9a612082cd75" class="">
</p><p id="d0b6616e-04bc-47f6-a660-4d13a6d4304f" class="">Maintenant que <strong>WordPress</strong> est installÃ©, mais pas configurÃ©, occupons nous de <strong>PHP</strong>.</p><p id="403f2fd3-dbb6-4043-b743-62e9bd300fbc" class=""><strong>PHP</strong> sert Ã  <strong>Wordpress</strong>, la plupart des fichiers de WordPress sont des .php.</p><figure class="block-color-gray_background callout" style="display:flex" id="6f200455-569e-4634-a81c-3fe946e5a965"><div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div><div style="width:100%">PHP est un langage de programmation libre, principalement utilisÃ© pour produire des pages Web dynamiques via un serveur HTTP, mais pouvant Ã©galement fonctionner comme n&#x27;importe quel langage interprÃ©tÃ© de faÃ§on locale.</div></figure><p id="2e7df36f-4bc6-45b6-8e4f-aaa5265443e6" class="">
</p><p id="578e3b73-63c5-4f85-8bbf-58e5dc123190" class="">Une fois quâ€™il est installÃ© avec <strong>APT</strong>, nous pouvons modifier son fichier de configuration.</p><p id="770cb135-677b-4bc0-b480-fa9a9445723d" class="">
</p><p id="2a4fe93b-c0b6-47ce-a6d0-d0607f9abf56" class="">Ici, jâ€™ai pris le fichier de configuration de base et jâ€™ai modifiÃ© seulement 2 petites choses.</p><p id="d52ea80c-db82-4f09-b5a2-21305c575ffb" class="">
</p><p id="413ecddd-f855-45a6-94b4-3d097383282e" class="">Jâ€™ai rajoutÃ© une ligne <code>clear_env = no</code> , je pense que cette ligne est assez claire pour ne pas avoir Ã  lâ€™expliquer, câ€™est pour lâ€™environnement.</p><p id="0d14f227-e214-4c37-ba4b-1ab531926876" class="">Mais jâ€™ai Ã©galement modifier la ligne <code>listen</code>, ici jâ€™ai indiquÃ© quâ€™il devait Ã©couter au port de WordPress, le <strong>9000</strong>. </p><p id="3b7f6bac-3b39-4ee1-9cde-4c4c262533a3" class="">Grosso modo ca donne : <code>listen=wordpress:9000</code> </p><p id="c2496054-d05b-4c93-8ae3-8827d82c01c7" class="">
</p><p id="8c353e25-002c-4908-a562-c5671ec5ba3a" class=""><strong>PHP</strong> est prÃªt, et oui, enfin aprÃ¨s il faut Ã©videmment demander au <mark class="highlight-blue"><strong>Dockerfile</strong></mark> de copier le fichier de configuration au bon endroit dans le container, mais Ã§a inutile de vous lâ€™expliquer vous devriez dÃ©jÃ  Ãªtre des experts dans le domaine.</p><p id="0023f300-9663-49e5-ab4f-48a4ab74c07e" class="">
</p><p id="f6152117-ef4c-476a-bd0d-5065cc77df2b" class="">Maintenant place Ã  la configuration de notre ami <strong>WordPress</strong>.</p><p id="c2806b96-61cb-4e6d-878a-42d8ffd0d6dd" class=""><span style="border-bottom:0.05em solid">Quoi il faut le configurer ?</span> ğŸ˜£</p><p id="1a82df73-87af-4dcd-a69c-3a801b1daaec" class="">
</p><p id="fbcec37a-de94-496a-967d-358906ae1448" class=""><strong>WordPress</strong> a besoin dâ€™une base de donnÃ©es pour fonctionner, du moins connaitre son <span style="border-bottom:0.05em solid"><strong>mot de passe</strong></span>, son <span style="border-bottom:0.05em solid"><strong>nom</strong></span> et son <span style="border-bottom:0.05em solid"><strong>host</strong></span>. </p><p id="b7c7deb6-87a0-4f90-81b3-26805c0fdf01" class="">Tout cela se configure dans le fichier <strong>wp-config.php</strong> <mark class="highlight-gray"><em>(un truc comme Ã§a)</em></mark></p><p id="27b8a428-95b9-4b1f-9ff9-293c89abed53" class="">
</p><p id="05d835db-d63c-410d-bfaf-8241ca6aa266" class="">Si vous ne le faites pas, vous arriverez directement sur la page de configuration du site, câ€™est pas plus mal, mais le sujet requiert une configuration automatique.</p><p id="6101e850-a961-4ea5-b7d6-da609d24cf86" class="">
</p><p id="fd9ccede-2811-4bdd-9e1b-53bd9dbbbf76" class="">Mais jâ€™ai une bonne nouvelle pour vous ! Un dÃ©veloppeur a simplement crÃ©Ã© une <strong>CLI</strong> qui permet de configurer presque automatiquement ce genre dâ€™informations pour vous.</p><p id="fa82d31f-fbea-40a7-b527-22a8bdcf599f" class="">Jetez un oeil Ã <a href="https://www.linode.com/docs/guides/how-to-install-wordpress-using-wp-cli-on-debian-10/"> ce super tuto</a>.</p><p id="796c1579-cf88-4543-8dc0-8f8c4ab80bde" class="">
</p><figure class="block-color-gray_background callout" style="display:flex" id="538660a7-c611-428a-82bd-5e2569e4abba"><div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div><div style="width:100%">Une CLI c&#x27;est une interface textuelleÂ qui traite les commandes vers un programmeÂ <strong>informatique</strong>. Il existe diffÃ©rentes interfaces de ligne de commande, tellesÂ que<strong> </strong>DOL et Shell Bash.</div></figure><p id="e1354b41-e2b0-4062-bbbc-bd4eaacebf7c" class="">
</p><p id="34852c21-c542-4a0e-9d3f-3c5e628acfd5" class="">Je fonce sur cette idÃ©e qui mâ€™a lâ€™air bien sympa, il faut dÃ©jÃ  rÃ©utiliser <strong>wget</strong> pour installer le CLI.</p><pre id="3ff53d5a-23b3-4622-8c7f-a461243ca651" class="code"><code>RUN wget https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar</code></pre><p id="82502bec-8c5d-4ca7-9314-cf2d511f0713" class="">
</p><figure class="block-color-gray_background callout" style="display:flex" id="506c9ad4-17ea-486c-a002-7e3b49dc946b"><div style="font-size:1.5em"><span class="icon">ğŸ¤”</span></div><div style="width:100%">Une autre possibilitÃ© aurait Ã©tÃ© de modifier directement le fichier <code>wp-config.php</code> Ã  coup de <code>sed</code> pour rentrer les infos directement dans le fichier.</div></figure><p id="f16bac6f-b1b9-4eeb-87d7-c0d657261150" class="">
</p><p id="d30c79d7-c65d-4ded-b0dc-02f64acf49bc" class="">Il faut ensuite lui donner les bons droits ainsi que le placer dans les binaires.</p><pre id="1235b6b7-4d69-4313-8f2c-6fc435df06ee" class="code"><code>RUN chmod +x wp-cli.phar
RUN mv wp-cli.phar /usr/local/bin/wp</code></pre><p id="91475091-9f19-4470-882f-904cdf3d2b75" class="">
</p><p id="c9bec406-7b96-496f-b0b1-45418fdf9e64" class="">Ok top ! On a installÃ© le <strong>CLI</strong> de <strong>WordPress</strong> ğŸ“„</p><p id="f799cc87-dfca-44d1-8700-834a6ffd10ee" class="">Maintenant il faudrait lâ€™utiliser, pour cela on va faire comme avec <strong>MariaDB</strong>, crÃ©er un petit script bash quâ€™on copiera et qui effectuera les commandes Ã  notre place au lancement du container. </p><p id="f1349181-d382-4162-b90f-71e4420363b5" class="">
</p><p id="a79d4503-29eb-4773-82df-53f2ebf0640a" class="">Je crÃ©e donc un <code>auto_config.sh</code> que je place dans le dossier <code><strong>conf</strong></code> de <strong>WordPress</strong>.</p><p id="56050544-c488-4244-85f9-7d435a003c90" class="">
</p><p id="31e534c0-ea17-4088-a7b4-e147486f3dcd" class="">Dans celui ci, je vais, par prÃ©caution mettre un <code>sleep 10</code> afin dâ€™Ãªtre certain que la base de donnÃ©es <strong>MariaDB</strong> a bien eu le temps de se lancer correctement.</p><p id="490585e7-65f4-4691-9ee7-924c3e5ee944" class="">Ensuite, et uniquement si notre fichier <code>wp-config.php</code> nâ€™existe pas <mark class="highlight-gray">(nous ne voudrions pas </mark><mark class="highlight-gray"><em>reconfigurer</em></mark><mark class="highlight-gray"> </mark><mark class="highlight-gray"><strong>WordPress</strong></mark><mark class="highlight-gray"> Ã  chaque lancement non ?)</mark> , nous utilisons la commande <code>wp config create</code> du <span style="border-bottom:0.05em solid"><strong>CLI</strong></span> pour indiquer les informations dont <strong>WordPress</strong> a besoin.</p><p id="959d2335-64c9-4647-8070-b9b519d66a47" class="">
</p><p id="5653fb13-0d8f-4b3b-a512-aad7d47b584c" class="">Nous pourrions remplir ces informations Ã  la main directement en accÃ©dant Ã  <a href="http://localhost">localhost</a> en lanÃ§ant notre container. </p><p id="2766905f-8fac-49a2-babd-21f61b770ab2" class="">Cela ressemblerait Ã  cela :</p><figure id="fb60048a-27db-43ac-80b2-9aba21562209" class="image"><a href="img/configuration.png"><img style="width:674px" src="img/configuration.png"/></a></figure><p id="c0d084ae-e3eb-4b33-89a2-c696cbd2868a" class=""><strong>â¯ Ceci est la premiÃ¨re page que prÃ©sente WordPress Ã  son lancement.</strong></p><p id="654db5cb-7b98-4b31-a48e-68c994389167" class="">
</p><p id="509499df-7b80-4feb-91f6-59055467522b" class="">Sauf que nous, nous voudrions que cela soit dÃ©jÃ  automatiquement configurÃ©.</p><p id="e932856a-a08d-4ea3-a615-717453930881" class="">Nous pouvons donc indiquer ces infos avec lâ€™aide de <code>wp config create</code> du <span style="border-bottom:0.05em solid">CLI</span>.</p><p id="1c414a5c-4ad8-4808-8d08-3016122f9c99" class="">
</p><p id="bdb1f8d2-5853-4663-852c-14dbfdf48951" class="">Cela donnerait quelque chose comme Ã§a :</p><pre id="4eb1d114-c023-4ce8-b910-3e0ac58bacd9" class="code"><code>wp config create	--allow-root \
    					--dbname=$SQL_DATABASE \
    					--dbuser=$SQL_USER \
    					--dbpass=$SQL_PASSWORD \
    					--dbhost=mariadb:3306 --path=&#x27;/var/www/wordpress&#x27;</code></pre><p id="30e68cf5-0f6c-4b38-aad4-8a46582077c7" class=""><strong>â¯ Ã€ indiquer directement aprÃ¨s notre sleep dans notre fichier auto_config.sh</strong></p><p id="0169a57c-66ba-4d47-a197-6dd602174285" class="">
</p><p id="d1f9d257-5a2f-463d-96a9-3a2d6a2b6a18" class="">Maintenant si nous lanÃ§ons le container <strong>WordPress</strong>, Ã§a ne devrait plus Ãªtre la page que je vous ai montrÃ© juste au dessus mais la deuxiÃ¨me, celle-ci est bien plus sympa.</p><figure id="93111a2b-91db-4316-bfc9-fca412bc51b5" class="image"><a href="img/install-step5_v47.png"><img style="width:795px" src="img/install-step5_v47.png"/></a></figure><p id="71ea0a1b-aaa3-4c41-b08c-667a1e57c359" class="">
</p><p id="a4423731-ac4a-4245-ae62-29b30d17fedd" class="">Câ€™est la page qui demande de choisir un <strong>titre</strong> pour votre site, ainsi quâ€™un <strong>nom dâ€™utilisateur</strong> et un <strong>mot de passe</strong>, mais la impossible dâ€™avoir faux car <span style="border-bottom:0.05em solid">câ€™est Ã  vous de le choisir</span> ğŸ˜</p><p id="5720bac1-2084-447c-b227-1b9a5d99d967" class="">Pour moi, il serait normal de laisser cette page de configuration Ã  remplir, mais le sujet demande quâ€™elle soit Ã©galement automatiquement configurÃ©e, car celui-ci demande quâ€™il y ait 2 utilisateurs <strong>WordPress</strong>, et câ€™est sur cette page quâ€™on peut configurer le premier.</p><p id="76c564d1-9f46-425a-b983-65fcd332f9ef" class="">
</p><p id="d5739510-0c5c-48e2-814e-2540c50561c8" class="">Je vous laisse regarder la doc du <strong>CLI</strong> mais celui ci propose de configurer cette deuxiÃ¨me page automatiquement avec la commande <code>wp core install</code> et mÃªme dâ€™ajouter un autre utilisateur avec la commande <code>wp user create</code> . Franchement je vous laisse la partie la plus simple.</p><p id="9dba471c-2447-438a-b402-9c0def259177" class="">
</p><p id="1290b96f-ced6-4b97-ac77-94ee9b31c017" class="">Plus quâ€™Ã  copier le fichier <code>auto_config.sh</code> dans votre container et lâ€™exÃ©cuter avec le mot clef <mark class="highlight-blue"><strong>ENTRYPOINT.</strong></mark></p><p id="0080e534-427b-4a3d-92f5-9385fe7efe84" class="">
</p><p id="16d4522b-d16a-440c-85e9-3c91cd2ce409" class="">Ensuite pour Ã©viter une erreur qui concerne le <strong>PHP</strong>, jâ€™ai rajoutÃ© une condition qui crÃ©e le dossier <code>/run/php</code> sâ€™il nâ€™existe pas.</p><p id="3fb2be81-accd-48aa-9682-58a4c50add84" class="">
</p><p id="1b54d6b6-ba9b-4662-9abf-21c111cdf3d9" class="">Ensuite je lance <strong>php-fpm</strong> avec la commande :</p><pre id="5403cf33-4067-45de-acdd-7c6f3b263937" class="code"><code>/usr/sbin/php-fpm7.3 -F</code></pre><p id="17adf571-0a29-4596-86e9-90b685063319" class="">
</p><p id="c2a01a08-23b3-4239-af9a-06893c82e3b9" class="">
</p><p id="compose" class="compose">Vous avez <span style="border-bottom:0.05em solid">terminÃ©</span> la configuration de votre container <strong>WordPress</strong>!</p><p id="95b26f1d-6e9b-4ecf-ad8f-8cc0b56f357d" class=""><br>
</p><p id="e2fcabc8-c9a6-4097-a5b4-7969280b9db5" class="">
</p><h1 id="3d58a5fe-1036-4ce0-aabb-77a86e84bed7" class="">6. Relier les containers avec Compose:</h1><h2 id="51a0e7a0-e19e-4ff7-b40a-41f4cadf0fc3" class="">Place au fameux <span style="border-bottom:0.05em solid">docker-compose.yml</span> !</h2><p id="426d092d-b7d8-4819-a215-5e70026b2513" class="">
</p><p id="ea0d5339-3bf3-4e83-9216-1cea7e548975" class="">Bon, dâ€™abord renseignez vous sur comment sâ€™Ã©crit un fichier <strong>docker-compose</strong>.</p><p id="109eff6c-05d2-48d8-8ea1-2309552de849" class="">Celui-ci commence toujours par la version de <mark class="highlight-blue"><strong>docker-compose</strong></mark>, la derniÃ¨re, la 3.</p><p id="7db682ec-774e-4c80-8127-f8220015e10b" class="">
</p><p id="6d6cef25-be20-449e-ac7b-58f9b63286e2" class="">La premiÃ¨re ligne sera donc : <code>version: â€˜3â€™</code></p><p id="cd74e6f2-5c19-4e3e-9917-7dc1f5ca1e26" class="">
</p><figure class="block-color-gray_background callout" style="display:flex" id="dfb5361f-61ea-44a5-9e5d-561dc05387d3"><div style="font-size:1.5em"><span class="icon">â›”</span></div><div style="width:100%">Attention Ã  lâ€™indentation du <strong>docker-compose.yml</strong> ! Comme pour Python, câ€™est lâ€™indentation qui compte.</div></figure><p id="a2c61d3e-b52d-4d1f-9ad1-e72bbc47177d" class="">
</p><p id="2ced7fbc-0e07-40a5-990a-d5a2fa652510" class="">Ensuite on indique la ligne <code>services:</code></p><p id="70e52c21-e058-47a8-9872-39a7603df9d2" class="">Et lÃ , avec une indentation de 1 <strong>tab</strong>, on peut Ã©numÃ©rer nos diffÃ©rents services.</p><p id="5367f9d4-d179-4dad-9a6b-fb6320b215c7" class="">Je commence par <strong>MariaDB :</strong></p><p id="e1247c46-9896-473e-a13a-a7609f621145" class="">
</p><pre id="50e2eeeb-c165-421b-9ed3-3e76dc82db02" class="code"><code>mariadb:
    container_name: mariadb   # Le nom du container, oui vraiment.
    networks:
      - inception             # Ã  quel network il appartient
    build: 
      context: requirements/mariadb # ou se trouve son Dockerfile
      dockerfile: Dockerfile        # le nom du Dockerfile ?!
    env_file: .env                  # le fichier d&#x27;environnement pour transmettre les variables
    volumes:                        # Voir plus bas
      - mariadb:/var/lib/mysql
    restart: unless-stopped          # redÃ©marre tant qu&#x27;il n&#x27;est pas stoppÃ© 
    expose:                          # le port Ã  exposer
      - &quot;3306&quot;</code></pre>
	  <p id="01817814-674a-442a-8d4d-f44ccc79b5cd" class="">Place au service <strong>NGINX</strong>, ici câ€™est le mÃªme principe, sauf deux choses qui changent et les <strong><em>noms/paths</em></strong> Ã©videmment.</p><p id="79c69731-a94e-491f-b563-d7efc6b32789" class="">
	</p><pre id="f2876a0c-3fc3-4fff-bcf2-f4050f54be60" class="code"><code>nginx:
		container_name: nginx
		volumes:
		  - wordpress:/var/www/wordpress
		networks:
		  - inception
		depends_on:         # Nouvelle ligne, indiquant de ne pas dÃ©marrer NGINX tant que WordPress n&#x27;a pas dÃ©marrÃ©.
		  - wordpress
		build: 
		  context: requirements/nginx
		  dockerfile: Dockerfile
		env_file: .env
		ports:
		  - &quot;443:443&quot; # on indique le port qui sera exposÃ© a la machine locale
		restart: on-failure # Ici nous changeons, le container redÃ©marrera uniquement en cas de crash.</code></pre><p id="f9666c6f-65b6-49a0-9f19-a2d6e541c673" class="">Câ€™est bon, vous lâ€™avez ? Faisons de mÃªme pour <strong>WordPress</strong>.</p><p id="d65ff5e0-67c9-43cf-9ac5-76adcbd35acb" class="">
	</p><pre id="bd551c4a-bfc6-4a9a-9da8-71fb2e8214e1" class="code"><code>wordpress:
		container_name: wordpress
		env_file: .env
		volumes:
		- wordpress:/var/www/wordpress
		networks:
		  - inception
		build: 
		  context: requirements/wordpress
		  dockerfile: Dockerfile
		depends_on:    # WordPress dÃ©marrera uniquement aprÃ¨s MariaDB (sinon il ne pourra pas configurer la base de donnÃ©es...)
		  - mariadb
		restart: on-failure
		expose: 
		  - &quot;9000&quot;</code></pre>
	  <p id="volumes" class=""><strong>â¯ Et voilÃ  ! (Jâ€™aurais aimÃ© quâ€™on fasse le taff de lire la doc Ã  ma place moi)</strong></p><p id="417d4d74-12b1-434a-9e1e-cc6dd43f328d" class=""><br><br><br>
</p><h1 id="1cc3e8e7-3014-409a-98a3-f459ca626f88" class="">7. Les volumes Ã  configurer:</h1><h3 id="2f3aba2b-f359-4a44-8751-927cc73ebabd" class="">Parlons rapidement de la ligne <span style="border-bottom:0.05em solid">Volumes</span>:</h3><p id="fc053ded-51ab-4687-8842-87ab9ede0455" class="">
</p><p id="3c6abda8-1123-4262-8c29-711f8ac9d3cb" class="">Nous assignons un <span style="border-bottom:0.05em solid">volume</span> Ã  <strong>MariaDB</strong>, comme nous allons le faire avec <strong>WordPress</strong>.</p><p id="261506ae-8d8d-41c4-a800-649c640aa5fb" class="">Câ€™est un <em>prÃ©requis</em> du sujet. Nous devons permettre la <span style="border-bottom:0.05em solid">persistance des donnÃ©es</span>, pour cela nous allons stocker certains dossiers directement sur notre ordinateur en local.</p><blockquote id="a61ae461-9f5d-4202-9b84-95e4bfa066f2" class="">Et oui, imaginez que votre container <strong>WordPress</strong> <strong><mark class="highlight-red">crash ou sâ€™Ã©teint</mark></strong>, et que par pur hasard, celui-ci a perdu tous vos fichiers, ce serait bien embÃªtant, câ€™est pour cela que nous prÃ©fÃ©rerons les stocker directement en local, et <mark class="highlight-blue"><strong>docker-compose</strong></mark> nous le permet.</blockquote><p id="ffb59fa5-66ab-45ef-8cdb-81c87312e4aa" class="">
</p><p id="269c87f4-fc43-4229-834b-34f5f1ba3d71" class=""><mark class="highlight-yellow_background">Dans le cas dâ€™Inception, nous allons stocker les dossiers de </mark><strong><mark class="highlight-yellow_background">MySQL </mark></strong><mark class="highlight-yellow_background">se trouvant dans </mark><code><mark class="highlight-yellow_background">/var/lib/mysql</mark></code><mark class="highlight-yellow_background">et WordPress dans </mark><code><mark class="highlight-yellow_background">var/www/wordpress</mark></code><mark class="highlight-yellow_background">. Ceux sont les </mark><strong><mark class="highlight-yellow_background">paths</mark></strong><mark class="highlight-yellow_background"> que jâ€™indique aprÃ¨s la ligne </mark><em><mark class="highlight-yellow_background">volume</mark></em><mark class="highlight-yellow_background">. Encore une fois câ€™est le sujet qui nous le demande.</mark></p><p id="7d122de1-e3b7-47f2-8db1-118b6da56f3f" class="">
</p><p id="6b6d2552-1feb-4937-9f58-b360e3a00751" class="">Ici Ã  la ligne volume nous indiquons <strong>MariaDB</strong> <em><mark class="highlight-gray">(câ€™est le nom du volume, nous aurions pu lâ€™appeler vol_maria ou autre, Ã©videmment il fera intervenir une ligne concernant les volumes dans le </mark></em><em><strong><mark class="highlight-gray">docker-compose.yml</mark></strong></em><em><mark class="highlight-gray"> qui permettra dâ€™indiquer oÃ¹ le stocker en local) </mark></em></p><p id="fdd98454-6b37-49cd-b10b-845db2177bdd" class="">suivi de <code>:</code> avec lâ€™endroit que nous souhaitons copier du container.</p>
<p id="d7be0a7d-35e6-4c8d-a919-a04e6b8b4fb0" class="">Il ne manque plus quâ€™Ã  prÃ©ciser les volumes que nous avons indiquÃ©s :</p><pre id="150e6453-ead2-4f7e-a295-01b98c6324d0" class="code"><code>volumes:
  wordpress:
    driver: local # ici nous stockons le volume en local
    driver_opts:
      type: &#x27;none&#x27; # aucun type spÃ©cifique
      o: &#x27;bind
      device: &#x27;/Users/jcluzet/data/wordpress&#x27; #Ou stocker le dossier sur votre ordinateur en local
  mariadb:
    driver: local
    driver_opts:
      type: &#x27;none&#x27; 
      o: &#x27;bind&#x27;                             # Les Bind Mounts sont des volumes qui se montent sur un chemin d&#x27;accÃ¨s Ã  l&#x27;hÃ´te, et ils peuvent Ãªtre modifiÃ©s par d&#x27;autres processus en dehors de docker.
      device: &#x27;/Users/jcluzet/data/mariadb&#x27; #Ou stocker le dossier sur votre ordinateur en local</code></pre><p id="159fbb1a-0e70-4c36-a4df-27c9ad14f3d4" class=""><strong>â¯ </strong><a href="https://docs.docker.com/compose/compose-file/compose-file-v3/"><strong>Cette doc</strong></a><strong> de docker explique bien comment gÃ©rer les volumes dans un docker-compose.</strong></p><p id="db1f0cad-51d1-43ca-8a48-179711d4dafb" class="">
</p><figure class="block-color-blue_background callout" style="display:flex" id="222850bf-983e-44a4-95f4-9ba95d26fe91"><div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div><div style="width:100%">Vos volumes seront disponibles dans le dossier /home/login/data de la machine hÃ´te utilisant Docker.</div></figure><p id="9940b5dc-0ce3-4995-b474-78e3a64a7040" class=""><strong>â¯ Pensez donc Ã  modifier le path de la ligne device: en consÃ©quence.</strong></p><p id="93486a86-0aec-4ad1-adf5-82a01c77b49f" class="">
</p><p id="308f42dd-c10e-4558-a924-9125f71a3eda" class="">Reste plus quâ€™Ã  crÃ©er la partie network, attention, câ€™est trÃ¨s simple.</p><pre id="7aea0220-53f2-4563-8872-e21d017b52b9" class="code"><code>networks:
    inception:
      driver: bridge</code></pre><p id="6f4a0766-d0c2-4e34-b78c-e47730a0dc41" class=""><strong>â¯ Oui câ€™est tout.</strong></p><p id="27cc4f93-588e-4946-84a8-b365be37c754" class="">
</p><figure class="block-color-gray_background callout" style="display:flex" id="29a2ba2e-b28d-409f-bbe1-c5d9671d4465"><div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div><div style="width:100%">Ici <code>bridge</code> indique a Docker dâ€™installer automatiquement des rÃ¨gles qui permettront aux 3 containers de communiquer en bridge.</div></figure><p id="389d58b5-0191-465f-84e9-a323b3201585" class="">
</p><p id="7f5daf03-75c8-4a4f-88d2-f29beef8412f" class="">Votre fichier <strong>docker-compose.yml</strong> est prÃªt ! Jâ€™espÃ¨re que vous nâ€™avez pas Ã©tÃ© jusquâ€™Ã  recopier les <strong>paths</strong> sans les modifier, ce serait dommage ğŸ¤ª</p><p id="466dd91d-d37c-46c6-a9e3-13b59796f16f" class="">
</p><p id="2ec29656-d4b2-4ba8-a375-0cbeeded9d49" class="">Ah jâ€™ai failli oublier ! Vous pouvez <strong>build</strong> votre fichier <mark class="highlight-yellow"><strong>.yaml</strong></mark> avec la commande </p><p id="1bb0ca05-eb11-4d3d-ba77-963d4defd4cf" class=""><code>docker-compose -f </code><em><code>&lt;path_docker_compose&gt;</code></em><code> -d â€”build</code></p><p id="b261a003-c466-4adc-abf6-c43d5d4e1153" class="">
</p><p id="24dfbb6b-1eb5-4dfc-8804-2bbc8953189f" class="">Pour lâ€™<strong>arrÃªter</strong> : <code>docker-compose -f </code><em><code>&lt;path_docker_compose&gt;</code></em><code> stop</code></p><p id="cb32153d-0413-4748-a5b2-f243ab7b6414" class="">Pour <strong>supprimer</strong> le build : <code>docker-compose -f </code><em><code>&lt;path_docker_compose&gt;</code></em><code> down -v</code></p><p id="8b9ca413-98b6-4a1a-8052-78df52dd55a6" class="">
</p><p id="4faf8b92-28eb-46b4-82fc-9137974c2493" class="">Si vous rencontrez des problÃ¨mes avec docker vous pouvez utiliser la commande :</p><p id="5b8a5f35-c882-4c6c-a622-6a3b13b0cf83" class=""><code>docker system prune -af </code> <mark class="highlight-yellow_background">Attention, Ã§a supprime tous les container, images, etc.</mark></p><p id="db2527db-5e9a-46ba-9652-a723392997a4" class="">
</p><hr id="5139a8bc-0047-414e-bc69-b55a3b30339f"/><p id="95e24c9c-561b-47bf-8d05-c2da7dea4c0a" class="">
</p><h1 id="4dc58c8c-9186-4add-876f-9106e909e568" class="">8. Finaliser le projet :</h1><h3 id="6e711da4-6b93-4e49-96bd-de36246737dd" class="">Petites rectifications:</h3><p id="17596f33-9491-4b67-b81f-06e7f47da2b6" class="">
</p><p id="03d868e9-3eb5-4602-bd8e-b5d05d858de7" class="">Depuis que jâ€™ai testÃ© tout cela, jâ€™ai remarquÃ© quelques petits bugs, jâ€™ai donc rajoutÃ© quelques petites prÃ©cisions au fichier de configuration de <strong>NGINX</strong>.</p><p id="e24b1942-d8af-4047-b617-0aebf651479c" class="">
</p><p id="5e3c97ca-6398-404f-a0da-013128f01cce" class="">Jâ€™ai ajoutÃ© en premiÃ¨re ligne le mot clef <code>events {}</code> car <strong>NGINX</strong> le demandait avec une erreur du type <code>missing events{}</code>.</p><p id="89cd7042-4228-4b23-bd1b-3f1ef15bc283" class="">
</p><p id="98562136-656c-4228-af68-9b94e739abf5" class="">Jâ€™ai Ã©galement ajoutÃ© la ligne <code>include /etc/nginx/mime.types;</code> juste en dessous du mot clef <strong>http</strong>.</p><p id="6a18c182-6931-4c80-9405-c589e229d0f9" class="">Pourquoi ? Le CSS ne chargeait pas, et aprÃ¨s une longue enquÃªte jâ€™ai remarquÃ© que ceux-ci Ã©tait indiquÃ© avec un Content-Type <strong>html </strong>?! </p><p id="86086555-8b5f-4572-b95f-0935ae967b0e" class="">AprÃ¨s de longues visites sur le site de <span style="border-bottom:0.05em solid">StackOverFlow</span> jâ€™ai finalement ajoutÃ© cette ligne qui prÃ©cise les <strong>content-types</strong>, et tout est rentrÃ© dans lâ€™ordre!</p><p id="1eed249e-c8db-4666-a2d7-b75d41018070" class="">
</p><p id="7a1ea36c-407e-4311-9de1-5e5ea1a5b2a4" class="">Ã€ priori, il ne vous reste plus quâ€™Ã  faire un Makefile et <span style="border-bottom:0.05em solid"><strong>vous Ãªtes bon</strong></span><strong> ğŸ¤©</strong></p><p id="341740d8-6933-4877-ae75-aa6ff8245bc3" class="">Ah oui, moi jâ€™ai aussi ajoutÃ© un mini script bash qui configure automatiquement les bon path dans docker-compose.yml, toujours sympa quand un ami veut tester le projet sur son ordinateur, il nâ€™a pas Ã  chercher chaque path dans tous les fichiers pour les changer.</p><p id="af566dbd-9c47-4e9f-b884-b3935eb23dcb" class="">
</p><hr id="56ad1840-931b-4f11-ad2d-2639392025a6"/><p id="3c81fa32-87a4-4f5f-8bb7-5be92b3ff50c" class="">
</p><p id="077bb3e8-d681-4a70-8b13-c632b9f1b625" class="">Si vous tentez de vous connecter Ã  <a href="http://localhost">localhost</a> ou 127.0.0.1 depuis votre navigateur <em><mark class="highlight-gray">(aprÃ¨s avoir lancÃ© votre container Ã©videmment) </mark></em>vous ne verrez sÃ»rement rien apparaitre. Normal nous nâ€™avons ouvert que le port <strong>443</strong> comme port dâ€™Ã©coute. </p><p id="6047e212-485c-4b12-bc57-9068a296a45f" class="">
</p><p id="085c4afa-5e3c-427d-80a5-4746580934e2" class="">Le port <strong>443</strong> correspondant au port <strong>SSL</strong> nous devons donc nous y connecter en utilisant <code>https://</code>et non <code>http://</code>, car ce dernier nous emmÃ¨nerait sur le port standard <strong>80</strong>, que nous aurions sÃ»rement configurÃ© sur un site classique (celui-ci aurait redirigÃ© vers le 443). Mais ici le sujet <mark class="highlight-red"><strong>interdit</strong></mark> lâ€™ouverture dâ€™un autre port que le <strong>443</strong>.</p><p id="0265a99a-c56f-4e4b-80f8-ecad305037dc" class="">
</p><p id="c9fde834-3524-4f34-8f52-b6d783591f27" class="">Maintenant, nouveau souci, selon votre navigateur, celui-ci devrait afficher un message <strong>dâ€™alerte </strong>indiquant que ce site <mark class="highlight-yellow_background">tente surement de vous </mark><span style="border-bottom:0.05em solid"><mark class="highlight-yellow_background">voler des informations sensibles</mark></span>.</p><p id="febadbac-8adf-4f13-a06b-27ebe43c14e6" class="">Dans le language dâ€™un <strong>dev</strong>, cela veut dire que le certificat <strong>SSL</strong> nâ€™a pas Ã©tÃ© signÃ© par <mark class="highlight-yellow"><strong>Trusted Authority</strong></mark>. Nous ne pouvons rien y faire quand il sâ€™agit dâ€™un projet en local et encore moins avec un certificat gÃ©nÃ©rÃ© par <strong>OpenSSL</strong>.</p><p id="566dd054-6465-4dc6-8974-51c7e8f28413" class="">Cependant, nous pouvons tout de mÃªme entrer sur le site. Pour Safari, il existe un bouton qui demande tout de mÃªme lâ€™accÃ¨s au site. Sur Chrome, il existe un petit secret, il suffit de taper le mot <code>thisisunsafe</code> quand vous Ãªtes sur la page dâ€™alerte.</p><p id="40c662d0-8594-4774-a482-d28a8bf43133" class="">Et voilÃ , vous devriez arriver sur votre site.</p><p id="44c9c917-cddc-4fcc-b9e1-13f50250d3a4" class="">
</p><figure class="block-color-blue_background callout" style="display:flex" id="316f2244-e89a-43c6-8f9f-d23d5e69cde6"><div style="font-size:1.5em"><span class="icon">ğŸ“–</span></div><div style="width:100%">Pour des questions de lisibilitÃ©, il faudra configurer votre nom de domaine afin quâ€™il pointe vers votre adresse IP locale.
Ce nom de domaine sera <a href="http://login.42.fr/">login.42.fr</a>. Ã€ nouveau, vous utiliserez votre login</div></figure><p id="e362fdfc-6746-465f-9ee7-6b6bfc7fc33e" class=""><strong>â¯ Ici il sâ€™agit uniquement dâ€™une configuration Ã  effectuer sur votre machine en local. </strong></p><p id="f5c1b57e-7525-414a-9e29-e202aeb0c666" class="">
</p><p id="4ba41374-294d-45b3-86be-9098a6a6a448" class="">En gros vous pouvez dÃ©jÃ  accÃ©der au site depuis <strong>localhost</strong>, qui <mark class="highlight-gray"><em>(ce mot)</em></mark> redirige en fait sur lâ€™IP <strong>127.0.0.1</strong>, sans vous le dire, mais tout cela est en fait Ã©crit dans un fichier de votre ordinateur. </p><blockquote id="d98556a2-3ebb-43f3-984c-10cf4f830796" class="">Ce fichier est trÃ¨s sensible et il vous faudra lâ€™Ã©diter avec un <code>sudo.</code> En effet, câ€™est un fichier trÃ¨s visÃ© par les hackers, il permettrait de vous rediriger facilement sur un faux google quand vous tapez <a href="http://google.fr">google.fr</a>, par exemple.</blockquote><p id="e41f70a8-3ed1-438f-ad16-f37e6595c002" class="">
</p><p id="c4913049-0822-40b9-b08c-81fab5db61c6" class="">En Ã©ditant ce fichier qui se trouve gÃ©nÃ©ralement ici : <code>/etc/hosts</code> vous pourrez facilement demander la redirection de <strong>127.0.0.1</strong> sur lâ€™IP que vous voudrez, comme <strong>login.42.fr</strong></p><figure class="block-color-gray_background callout" style="display:flex" id="c7b6bfa8-36d8-43e4-a374-07fbcc16d19a"><div style="font-size:1.5em"><span class="icon">ğŸ’¡</span></div><div style="width:100%">Nâ€™oubliez pas de modifier cet IP dans le fichier de conf de NGINX dans la case <code>server_name</code> , le mieux serait de le faire aussi dans la gÃ©nÃ©ration du certificat <strong>SSL</strong>, mais bon, celui-ci nâ€™est pas authentifiÃ©â€¦</div></figure><p id="c160eb00-7470-4ad1-b328-82cf78e17d50" class="">
</p><p id="c9e7f6ec-2878-4598-9a18-809a849606ac" class="">Ã€ priori vous respectez maintenant toutes les rÃ¨gles du sujet. </p><p id="4e2e27eb-57c9-4fc0-9d85-9fdfc6d76840" class="">Bon courage pour la correction ! ğŸ”</p>
</div></article></body>
<footer>
	<p id="copyright" class="copyright">Â© Copyright JCluzet 2022</p>
	<a href="https://grademe.fr" id="grademe" class="grademe"><img src="img/bigg.png" class="logofooter" alt="logo footer"></a>
</footer>
</html>